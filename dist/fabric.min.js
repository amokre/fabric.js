var fabric=fabric||{version:"1.6.0-rc.1"};"undefined"!==typeof exports&&(exports.fabric=fabric);"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow);fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;
fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;
(function(){function h(a,b){this.__eventListeners[a]&&(b?fabric.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function d(a,b){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var f in a)this.on(f,a[f]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function g(a,b){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===
typeof arguments[0])for(var f in a)h.call(this,f,a[f]);else h.call(this,a,b);return this}}function c(a,b){if(this.__eventListeners){var f=this.__eventListeners[a];if(f){for(var e=0,c=f.length;e<c;e++)f[e].call(this,b||{});return this}}}fabric.Observable={observe:d,stopObserving:g,fire:c,on:d,off:g,trigger:c}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var h=0,d=arguments.length;h<d;h++)this._onObjectAdded(arguments[h]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(h,d,g){var c=this.getObjects();g?c[d]=h:c.splice(d,0,h);this._onObjectAdded(h);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var h=this.getObjects(),d,g=0,c=arguments.length;g<c;g++)d=h.indexOf(arguments[g]),-1!==d&&(h.splice(d,1),this._onObjectRemoved(arguments[g]));
this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(h,d){for(var g=this.getObjects(),c=g.length;c--;)h.call(d,g[c],c,g);return this},getObjects:function(h){return"undefined"===typeof h?this._objects:this._objects.filter(function(d){return d.type===h})},item:function(h){return this.getObjects()[h]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(h){return-1<this.getObjects().indexOf(h)},complexity:function(){return this.getObjects().reduce(function(h,
d){return h+=d.complexity?d.complexity():0},0)}};
(function(h){var d=Math.sqrt,g=Math.atan2,c=Math.PI/180;fabric.util={removeFromArray:function(a,b){var f=a.indexOf(b);-1!==f&&a.splice(f,1);return a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*c},radiansToDegrees:function(a){return a/c},rotatePoint:function(a,b,f){a.subtractEquals(b);var e=Math.sin(f);f=Math.cos(f);return(new fabric.Point(a.x*f-a.y*e,a.x*e+a.y*f)).addEquals(b)},transformPoint:function(a,b,f){return f?new fabric.Point(b[0]*
a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new fabric.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},invertTransform:function(a){var b=1/(a[0]*a[3]-a[1]*a[2]),b=[b*a[3],-b*a[1],-b*a[2],b*a[0]];a=fabric.util.transformPoint({x:a[4],y:a[5]},b,!0);b[4]=-a.x;b[5]=-a.y;return b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var f=/\D{0,2}$/.exec(a),e=parseFloat(a);b||(b=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(f[0]){case "mm":return e*fabric.DPI/25.4;case "cm":return e*
fabric.DPI/2.54;case "in":return e*fabric.DPI;case "pt":return e*fabric.DPI/72;case "pc":return e*fabric.DPI/72*12;case "em":return e*b;default:return e}},falseFunction:function(){return!1},getKlass:function(a,b){a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return fabric.util.resolveNamespace(b)[a]},resolveNamespace:function(a){if(!a)return fabric;a=a.split(".");for(var b=a.length,f=h||fabric.window,e=0;e<b;++e)f=f[a[e]];return f},loadImage:function(a,b,f,e){if(a){var c=fabric.util.createImage();
c.onload=function(){b&&b.call(f,c);c=c.onload=c.onerror=null};c.onerror=function(){fabric.log("Error loading "+c.src);b&&b.call(f,null,!0);c=c.onload=c.onerror=null};0!==a.indexOf("data")&&"undefined"!==typeof e&&(c.crossOrigin=e);c.src=a}else b&&b.call(f,a)},enlivenObjects:function(a,b,f,e){function c(){++g===h&&b&&b(d)}a=a||[];var d=[],g=0,h=a.length;h?a.forEach(function(a,b){if(a&&a.type){var g=fabric.util.getKlass(a.type,f);g.async?g.fromObject(a,function(f,g){g||(d[b]=f,e&&e(a,d[b]));c()}):(d[b]=
g.fromObject(a),e&&e(a,d[b]),c())}else c()}):b&&b(d)},groupSVGElements:function(a,b,f){a=new fabric.PathGroup(a,b);"undefined"!==typeof f&&a.setSourcePath(f);return a},populateWithProperties:function(a,b,f){if(f&&"[object Array]"===Object.prototype.toString.call(f))for(var e=0,c=f.length;e<c;e++)f[e]in a&&(b[f[e]]=a[f[e]])},drawDashedLine:function(a,b,f,e,c,v){e-=b;var t=c-f;c=d(e*e+t*t);e=g(t,e);var t=v.length,h=0,E=!0;a.save();a.translate(b,f);a.moveTo(0,0);a.rotate(e);for(b=0;c>b;)b+=v[h++%t],
b>c&&(b=c),a[E?"lineTo":"moveTo"](b,0),E=!E;a.restore()},createCanvasElement:function(a){a||(a=fabric.document.createElement("canvas"));a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a);return a},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){a=a.prototype;for(var b=a.stateProperties.length;b--;){var f=a.stateProperties[b],e=f.charAt(0).toUpperCase()+f.slice(1),
c="set"+e,e="get"+e;a[e]||(a[e]=new Function('return this.get("'+f+'")'));a[c]||(a[c]=new Function("value",'return this.set("'+f+'", value)'))}},clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,
b,f,e){0<e&&(b=b>e?b-e:0,f=f>e?f-e:0);var c=!0;a=a.getImageData(b,f,2*e||1,2*e||1);b=3;for(f=a.data.length;b<f&&(c=0>=a.data[b],!1!==c);b+=4);return c}}})("undefined"!==typeof exports?exports:this);
(function(){function h(f,b,c,h,E,A,C){var p=e.call(arguments);if(a[p])return a[p];var n=Math.PI,k=C*n/180,q=Math.sin(k),k=Math.cos(k),u=0,l=0;c=Math.abs(c);h=Math.abs(h);var m=-k*f*.5-q*b*.5,x=-k*b*.5+q*f*.5,w=c*c,z=h*h,D=x*x,B=m*m,F=w*z-w*D-z*B,G=0;0>F?(w=Math.sqrt(1-F/(w*z)),c*=w,h*=w):G=(E===A?-1:1)*Math.sqrt(F/(w*D+z*B));D=G*c*x/h;B=-G*h*m/c;G=k*D-q*B+.5*f;w=q*D+k*B+.5*b;z=g(1,0,(m-D)/c,(x-B)/h);x=g((m-D)/c,(x-B)/h,(-m-D)/c,(-x-B)/h);0===A&&0<x?x-=2*n:1===A&&0>x&&(x+=2*n);n=Math.ceil(Math.abs(x/
n*2));m=[];x/=n;D=8/3*Math.sin(x/4)*Math.sin(x/4)/Math.sin(x/2);B=z+x;for(F=0;F<n;F++)m[F]=d(z,B,k,q,c,h,G,w,D,u,l),u=m[F][4],l=m[F][5],z=B,B+=x;return a[p]=m}function d(a,f,c,d,g,h,C,p,n,k,q){var u=e.call(arguments);if(b[u])return b[u];var l=Math.cos(a),m=Math.sin(a),x=Math.cos(f),w=Math.sin(f),z=c*g*x-d*h*w+C,D=d*g*x+c*h*w+p;b[u]=[k+n*(-c*g*m-d*h*l),q+n*(-d*g*m+c*h*l),z+n*(c*g*w+d*h*x),D+n*(d*g*w-c*h*x),z,D];return b[u]}function g(a,f,e,b){a=Math.atan2(f,a);e=Math.atan2(b,e);return e>=a?e-a:2*Math.PI-
(a-e)}function c(a,b,c,d,g,h,C,p){var n=e.call(arguments);if(f[n])return f[n];var k=Math.sqrt,q=Math.min,u=Math.max,l=Math.abs,m=[],x=[[],[]],w,z,D,B,F;z=6*a-12*c+6*g;w=-3*a+9*c-9*g+3*C;D=3*c-3*a;for(var G=0;2>G;++G)0<G&&(z=6*b-12*d+6*h,w=-3*b+9*d-9*h+3*p,D=3*d-3*b),1E-12>l(w)?1E-12>l(z)||(B=-D/z,0<B&&1>B&&m.push(B)):(B=z*z-4*D*w,0>B||(F=k(B),B=(-z+F)/(2*w),0<B&&1>B&&m.push(B),B=(-z-F)/(2*w),0<B&&1>B&&m.push(B)));for(l=k=m.length;k--;)B=m[k],z=1-B,w=z*z*z*a+3*z*z*B*c+3*z*B*B*g+B*B*B*C,x[0][k]=w,w=
z*z*z*b+3*z*z*B*d+3*z*B*B*h+B*B*B*p,x[1][k]=w;x[0][l]=a;x[1][l]=b;x[0][l+1]=C;x[1][l+1]=p;q=[{x:q.apply(null,x[0]),y:q.apply(null,x[1])},{x:u.apply(null,x[0]),y:u.apply(null,x[1])}];return f[n]=q}var a={},b={},f={},e=Array.prototype.join;fabric.util.drawArc=function(a,f,e,b){var c=[[],[],[],[]];b=h(b[5]-f,b[6]-e,b[0],b[1],b[3],b[4],b[2]);for(var d=0,g=b.length;d<g;d++)c[d][0]=b[d][0]+f,c[d][1]=b[d][1]+e,c[d][2]=b[d][2]+f,c[d][3]=b[d][3]+e,c[d][4]=b[d][4]+f,c[d][5]=b[d][5]+e,a.bezierCurveTo.apply(a,
c[d])};fabric.util.getBoundsOfArc=function(a,f,e,b,d,g,C,p,n){var k=0,q=0,u=[],l=[];e=h(p-a,n-f,e,b,g,C,d);b=[[],[]];d=0;for(g=e.length;d<g;d++)u=c(k,q,e[d][0],e[d][1],e[d][2],e[d][3],e[d][4],e[d][5]),b[0].x=u[0].x+a,b[0].y=u[0].y+f,b[1].x=u[1].x+a,b[1].y=u[1].y+f,l.push(b[0]),l.push(b[1]),k=e[d][4],q=e[d][5];return l};fabric.util.getBoundsOfCurve=c})();
(function(){function h(d,c,a){if(d&&0!==d.length){var b=d.length-1,f=c?d[b][c]:d[b];if(c)for(;b--;)a(d[b][c],f)&&(f=d[b][c]);else for(;b--;)a(d[b],f)&&(f=d[b]);return f}}var d=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(d){if(void 0===this||null===this)throw new TypeError;var c=Object(this),a=c.length>>>0;if(0===a)return-1;var b=0;0<arguments.length&&(b=Number(arguments[1]),b!==b?b=0:0!==b&&b!==Number.POSITIVE_INFINITY&&b!==Number.NEGATIVE_INFINITY&&(b=(0<b||-1)*
Math.floor(Math.abs(b))));if(b>=a)return-1;for(b=0<=b?b:Math.max(a-Math.abs(b),0);b<a;b++)if(b in c&&c[b]===d)return b;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(d,c){for(var a=0,b=this.length>>>0;a<b;a++)a in this&&d.call(c,this[a],a,this)});Array.prototype.map||(Array.prototype.map=function(d,c){for(var a=[],b=0,f=this.length>>>0;b<f;b++)b in this&&(a[b]=d.call(c,this[b],b,this));return a});Array.prototype.every||(Array.prototype.every=function(d,c){for(var a=0,b=this.length>>>
0;a<b;a++)if(a in this&&!d.call(c,this[a],a,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(d,c){for(var a=0,b=this.length>>>0;a<b;a++)if(a in this&&d.call(c,this[a],a,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(d,c){for(var a=[],b,f=0,e=this.length>>>0;f<e;f++)f in this&&(b=this[f],d.call(c,b,f,this)&&a.push(b));return a});Array.prototype.reduce||(Array.prototype.reduce=function(d){var c=this.length>>>0,a=0,b;if(1<arguments.length)b=
arguments[1];else{do{if(a in this){b=this[a++];break}if(++a>=c)throw new TypeError;}while(1)}for(;a<c;a++)a in this&&(b=d.call(null,b,this[a],a,this));return b});fabric.util.array={invoke:function(g,c){for(var a=d.call(arguments,2),b=[],f=0,e=g.length;f<e;f++)b[f]=a.length?g[f][c].apply(g[f],a):g[f][c].call(g[f]);return b},min:function(d,c){return h(d,c,function(a,b){return a<b})},max:function(d,c){return h(d,c,function(a,b){return a>=b})}}})();
(function(){function h(d,g){for(var c in g)d[c]=g[c];return d}fabric.util.object={extend:h,clone:function(d){return h({},d)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(h){return h.replace(/-+(.)?/g,function(d,g){return g?g.toUpperCase():""})},capitalize:function(h,d){return h.charAt(0).toUpperCase()+(d?h.slice(1):h.slice(1).toLowerCase())},escapeXml:function(h){return h.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var h=Array.prototype.slice,d=Function.prototype.apply,g=function(){};Function.prototype.bind||(Function.prototype.bind=function(c){var a=this,b=h.call(arguments,1),f;f=b.length?function(){return d.call(a,this instanceof g?this:c,b.concat(h.call(arguments)))}:function(){return d.call(a,this instanceof g?this:c,arguments)};g.prototype=this.prototype;f.prototype=new g;return f})})();
(function(){function h(){}function d(a){var e=this.constructor.superclass.prototype[a];return 1<arguments.length?e.apply(this,g.call(arguments,1)):e.call(this)}var g=Array.prototype.slice,c=function(){},a=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),b=function(f,e,b){for(var c in e)c in f.prototype&&"function"===typeof f.prototype[c]&&-1<(e[c]+"").indexOf("callSuper")?f.prototype[c]=function(a){return function(){var f=this.constructor.superclass;this.constructor.superclass=
b;var c=e[a].apply(this,arguments);this.constructor.superclass=f;if("initialize"!==a)return c}}(c):f.prototype[c]=e[c],a&&(e.toString!==Object.prototype.toString&&(f.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(f.prototype.valueOf=e.valueOf))};fabric.util.createClass=function(){function a(){this.initialize.apply(this,arguments)}var e=null,r=g.call(arguments,0);"function"===typeof r[0]&&(e=r.shift());a.superclass=e;a.subclasses=[];e&&(h.prototype=e.prototype,a.prototype=new h,
e.subclasses.push(a));for(var v=0,t=r.length;v<t;v++)b(a,r[v],e);a.prototype.initialize||(a.prototype.initialize=c);a.prototype.constructor=a;a.prototype.callSuper=d;return a}})();
(function(){function h(a){var e=Array.prototype.slice.call(arguments,1),f,b,c=e.length;for(b=0;b<c;b++)if(f=typeof a[e[b]],!/^(?:function|object|unknown)$/.test(f))return!1;return!0}function d(e,f){return function(b){f.call(a(e),b||fabric.window.event)}}function g(a,e){return function(f){if(t[a]&&t[a][e])for(var b=t[a][e],c=0,d=b.length;c<d;c++)b[c].call(this,f||fabric.window.event)}}function c(a,e,f){var b="touchend"===a.type?"changedTouches":"touches";return a[b]&&a[b][0]?a[b][0][e]-(a[b][0][e]-
a[b][0][f])||a[f]:a[f]}var a,b,f=function(){var a=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+a++)}}();(function(){var e={};a=function(a){return e[a]};b=function(a,f){e[a]=f}})();var e=h(fabric.document.documentElement,"addEventListener","removeEventListener")&&h(fabric.window,"addEventListener","removeEventListener"),r=h(fabric.document.documentElement,"attachEvent","detachEvent")&&h(fabric.window,"attachEvent","detachEvent"),v={},t={};e?(e=function(a,e,f){a.addEventListener(e,
f,!1)},r=function(a,e,f){a.removeEventListener(e,f,!1)}):r?(e=function(a,e,c){var g=f(a);b(g,a);v[g]||(v[g]={});v[g][e]||(v[g][e]=[]);c={handler:c,wrappedHandler:d(g,c)};v[g][e].push(c);a.attachEvent("on"+e,c.wrappedHandler)},r=function(a,e,b){var c=f(a),d;if(v[c]&&v[c][e])for(var g=0,r=v[c][e].length;g<r;g++)(d=v[c][e][g])&&d.handler===b&&(a.detachEvent("on"+e,d.wrappedHandler),v[c][e][g]=null)}):(e=function(a,e,b){var c=f(a);t[c]||(t[c]={});if(!t[c][e]){t[c][e]=[];var d=a["on"+e];d&&t[c][e].push(d);
a["on"+e]=g(c,e)}t[c][e].push(b)},r=function(a,e,b){a=f(a);if(t[a]&&t[a][e]){e=t[a][e];a=0;for(var c=e.length;a<c;a++)e[a]===b&&e.splice(a,1)}});fabric.util.addListener=e;fabric.util.removeListener=r;var y=function(a){return"unknown"!==typeof a.clientX?a.clientX:0},E=function(a){return"unknown"!==typeof a.clientY?a.clientY:0};fabric.isTouchSupported&&(y=function(a){return c(a,"pageX","clientX")},E=function(a){return c(a,"pageY","clientY")});fabric.util.getPointer=function(a){a||(a=fabric.window.event);
var e=fabric.util.getScrollLeftTop(a.target||("unknown"!==typeof a.srcElement?a.srcElement:null));return{x:y(a)+e.left,y:E(a)+e.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var h=fabric.document.createElement("div"),d="string"===typeof h.style.filter,g=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(a){return a};"string"===typeof h.style.opacity?c=function(a,b){a.style.opacity=b;return a}:d&&(c=function(a,b){var f=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(f.zoom=1);g.test(f.filter)?f.filter=f.filter.replace(g,.9999<=b?"":"alpha(opacity="+100*b+")"):f.filter+=" alpha(opacity="+100*b+")";return a});fabric.util.setStyle=function(a,b){var f=a.style;
if(!f)return a;if("string"===typeof b)return a.style.cssText+=";"+b,-1<b.indexOf("opacity")?c(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var e in b)"opacity"===e?c(a,b[e]):f["float"===e||"cssFloat"===e?"undefined"===typeof f.styleFloat?"cssFloat":"styleFloat":e]=b[e];return a}})();
(function(){function h(a,f){var b=fabric.document.createElement(a),c;for(c in f)"class"===c?b.className=f[c]:"for"===c?b.htmlFor=f[c]:b.setAttribute(c,f[c]);return b}function d(a){for(var f=0,b=0,c=fabric.document.documentElement,d=fabric.document.body||{scrollLeft:0,scrollTop:0};a&&a.parentNode&&(a=a.parentNode,a===fabric.document?(f=d.scrollLeft||c.scrollLeft||0,b=d.scrollTop||c.scrollTop||0):(f+=a.scrollLeft||0,b+=a.scrollTop||0),1!==a.nodeType||"fixed"!==fabric.util.getElementStyle(a,"position")););
return{left:f,top:b}}var g=Array.prototype.slice,c,a=function(a){return g.call(a,0)};try{c=a(fabric.document.childNodes)instanceof Array}catch(b){}c||(a=function(a){for(var f=Array(a.length),b=a.length;b--;)f[b]=a[b];return f});var f;f=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,f){var b=fabric.document.defaultView.getComputedStyle(a,null);return b?b[f]:void 0}:function(a,f){var b=a.style[f];!b&&a.currentStyle&&(b=a.currentStyle[f]);return b};(function(){var a=
fabric.document.documentElement.style,f="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction);f?a.style[f]="none":"string"===typeof a.unselectable&&(a.unselectable="on");return a};fabric.util.makeElementSelectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=
null);f?a.style[f]="":"string"===typeof a.unselectable&&(a.unselectable="");return a}})();(function(){fabric.util.getScript=function(a,f){var b=fabric.document.getElementsByTagName("head")[0],c=fabric.document.createElement("script"),d=!0;c.onload=c.onreadystatechange=function(a){!d||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!1,f(a||fabric.window.event),c=c.onload=c.onreadystatechange=null)};c.src=a;b.appendChild(c)}})();fabric.util.getById=function(a){return"string"===
typeof a?fabric.document.getElementById(a):a};fabric.util.toArray=a;fabric.util.makeElement=h;fabric.util.addClass=function(a,f){a&&-1===(" "+a.className+" ").indexOf(" "+f+" ")&&(a.className+=(a.className?" ":"")+f)};fabric.util.wrapElement=function(a,f,b){"string"===typeof f&&(f=h(f,b));a.parentNode&&a.parentNode.replaceChild(f,a);f.appendChild(a);return f};fabric.util.getScrollLeftTop=d;fabric.util.getElementOffset=function(a){var b;b=a&&a.ownerDocument;var c={left:0,top:0},g={left:0,top:0},h=
{borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!b)return g;for(var E in h)g[h[E]]+=parseInt(f(a,E),10)||0;b=b.documentElement;"undefined"!==typeof a.getBoundingClientRect&&(c=a.getBoundingClientRect());a=d(a);return{left:c.left+a.left-(b.clientLeft||0)+g.left,top:c.top+a.top-(b.clientTop||0)+g.top}};fabric.util.getElementStyle=f})();
(function(){function h(c,a){return c+(/\?/.test(c)?"&":"?")+a}function d(){}var g=function(){for(var c=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],a=c.length;a--;)try{if(c[a]())return c[a]}catch(b){}}();fabric.util.request=function(c,a){a||(a={});var b=a.method?a.method.toUpperCase():"GET",f=a.onComplete||function(){},e=g(),r;e.onreadystatechange=
function(){4===e.readyState&&(f(e),e.onreadystatechange=d)};"GET"===b&&(r=null,"string"===typeof a.parameters&&(c=h(c,a.parameters)));e.open(b,c,!0);"POST"!==b&&"PUT"!==b||e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.send(r);return e}})();fabric.log=function(){};fabric.warn=function(){};
"undefined"!==typeof console&&["log","warn"].forEach(function(h){"undefined"!==typeof console[h]&&"function"===typeof console[h].apply&&(fabric[h]=function(){return console[h].apply(console,arguments)})});
(function(){function h(a,b,f,e){a<Math.abs(b)?(a=b,e=f/4):e=f/(2*Math.PI)*Math.asin(b/a);return{a:a,c:b,p:f,s:e}}function d(a,b,f){return a.a*Math.pow(2,10*--b)*Math.sin(2*(b*f-a.s)*Math.PI/a.p)}function g(a,b,f,e){return f-c(e-a,0,f,e)+b}function c(a,b,f,e){return(a/=e)<1/2.75?7.5625*f*a*a+b:a<2/2.75?f*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?f*(7.5625*(a-=2.25/2.75)*a+.9375)+b:f*(7.5625*(a-=2.625/2.75)*a+.984375)+b}fabric.util.ease={easeInQuad:function(a,b,f,e){return f*(a/=e)*a+b},easeOutQuad:function(a,
b,f,e){return-f*(a/=e)*(a-2)+b},easeInOutQuad:function(a,b,f,e){a/=e/2;return 1>a?f/2*a*a+b:-f/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,f,e){return f*(a/=e)*a*a+b},easeOutCubic:function(a,b,f,e){return f*((a=a/e-1)*a*a+1)+b},easeInOutCubic:function(a,b,f,e){a/=e/2;return 1>a?f/2*a*a*a+b:f/2*((a-=2)*a*a+2)+b},easeInQuart:function(a,b,f,e){return f*(a/=e)*a*a*a+b},easeOutQuart:function(a,b,f,e){return-f*((a=a/e-1)*a*a*a-1)+b},easeInOutQuart:function(a,b,f,e){a/=e/2;return 1>a?f/2*a*a*a*a+b:-f/2*
((a-=2)*a*a*a-2)+b},easeInQuint:function(a,b,f,e){return f*(a/=e)*a*a*a*a+b},easeOutQuint:function(a,b,f,e){return f*((a=a/e-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,f,e){a/=e/2;return 1>a?f/2*a*a*a*a*a+b:f/2*((a-=2)*a*a*a*a+2)+b},easeInSine:function(a,b,f,e){return-f*Math.cos(a/e*(Math.PI/2))+f+b},easeOutSine:function(a,b,f,e){return f*Math.sin(a/e*(Math.PI/2))+b},easeInOutSine:function(a,b,f,e){return-f/2*(Math.cos(Math.PI*a/e)-1)+b},easeInExpo:function(a,b,f,e){return 0===a?b:f*Math.pow(2,
10*(a/e-1))+b},easeOutExpo:function(a,b,f,e){return a===e?b+f:f*(-Math.pow(2,-10*a/e)+1)+b},easeInOutExpo:function(a,b,f,e){if(0===a)return b;if(a===e)return b+f;a/=e/2;return 1>a?f/2*Math.pow(2,10*(a-1))+b:f/2*(-Math.pow(2,-10*--a)+2)+b},easeInCirc:function(a,b,f,e){return-f*(Math.sqrt(1-(a/=e)*a)-1)+b},easeOutCirc:function(a,b,f,e){return f*Math.sqrt(1-(a=a/e-1)*a)+b},easeInOutCirc:function(a,b,f,e){a/=e/2;return 1>a?-f/2*(Math.sqrt(1-a*a)-1)+b:f/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeInElastic:function(a,
b,f,e){var c=0;if(0===a)return b;a/=e;if(1===a)return b+f;c||(c=.3*e);f=h(f,f,c,1.70158);return-d(f,a,e)+b},easeOutElastic:function(a,b,f,e){var c=0;if(0===a)return b;a/=e;if(1===a)return b+f;c||(c=.3*e);f=h(f,f,c,1.70158);return f.a*Math.pow(2,-10*a)*Math.sin(2*(a*e-f.s)*Math.PI/f.p)+f.c+b},easeInOutElastic:function(a,b,f,e){var c=0;if(0===a)return b;a/=e/2;if(2===a)return b+f;c||(c=.3*e*1.5);f=h(f,f,c,1.70158);return 1>a?-.5*d(f,a,e)+b:f.a*Math.pow(2,-10*--a)*Math.sin(2*(a*e-f.s)*Math.PI/f.p)*.5+
f.c+b},easeInBack:function(a,b,f,e,c){void 0===c&&(c=1.70158);return f*(a/=e)*a*((c+1)*a-c)+b},easeOutBack:function(a,b,f,e,c){void 0===c&&(c=1.70158);return f*((a=a/e-1)*a*((c+1)*a+c)+1)+b},easeInOutBack:function(a,b,f,e,c){void 0===c&&(c=1.70158);a/=e/2;return 1>a?f/2*a*a*(((c*=1.525)+1)*a-c)+b:f/2*((a-=2)*a*(((c*=1.525)+1)*a+c)+2)+b},easeInBounce:g,easeOutBounce:c,easeInOutBounce:function(a,b,f,e){return a<e/2?.5*g(2*a,0,f,e)+b:.5*c(2*a-e,0,f,e)+.5*f+b}}})();
(function(){function h(){return d.apply(fabric.window,arguments)}var d=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(d){fabric.window.setTimeout(d,1E3/60)};fabric.util.animate=function(d){h(function(c){d||(d={});var a=c||+new Date,b=d.duration||500,f=a+b,e,r=d.onChange||function(){},v=d.abort||function(){return!1},t=d.easing||function(a,f,
e,b){return-e*Math.cos(a/b*(Math.PI/2))+e+f},y="startValue"in d?d.startValue:0;c="endValue"in d?d.endValue:100;var E=d.byValue||c-y;d.onStart&&d.onStart();(function C(c){e=c||+new Date;c=e>f?b:e-a;v()?d.onComplete&&d.onComplete():(r(t(c,y,E,b)),e>f?d.onComplete&&d.onComplete():h(C))})(a)})};fabric.util.requestAnimFrame=h})();
(function(h){function d(d,c){this.x=d;this.y=c}h=h.fabric||(h.fabric={});h.Point?h.warn("fabric.Point is already defined"):(h.Point=d,d.prototype={constructor:d,add:function(g){return new d(this.x+g.x,this.y+g.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(g){return new d(this.x+g,this.y+g)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(g){return new d(this.x-g.x,this.y-g.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},
scalarSubtract:function(g){return new d(this.x-g,this.y-g)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(g){return new d(this.x*g,this.y*g)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(g){return new d(this.x/g,this.y/g)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return this.x===d.x&&this.y===d.y},lt:function(d){return this.x<d.x&&this.y<d.y},lte:function(d){return this.x<=d.x&&this.y<=d.y},gt:function(d){return this.x>
d.x&&this.y>d.y},gte:function(d){return this.x>=d.x&&this.y>=d.y},lerp:function(g,c){return new d(this.x+(g.x-this.x)*c,this.y+(g.y-this.y)*c)},distanceFrom:function(d){var c=this.x-d.x;d=this.y-d.y;return Math.sqrt(c*c+d*d)},midPointFrom:function(g){return new d(this.x+(g.x-this.x)/2,this.y+(g.y-this.y)/2)},min:function(g){return new d(Math.min(this.x,g.x),Math.min(this.y,g.y))},max:function(g){return new d(Math.max(this.x,g.x),Math.max(this.y,g.y))},toString:function(){return this.x+","+this.y},
setXY:function(d,c){this.x=d;this.y=c},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(d){var c=this.x,a=this.y;this.x=d.x;this.y=d.y;d.x=c;d.y=a}})})("undefined"!==typeof exports?exports:this);
(function(h){function d(c){this.status=c;this.points=[]}var g=h.fabric||(h.fabric={});g.Intersection?g.warn("fabric.Intersection is already defined"):(g.Intersection=d,g.Intersection.prototype={appendPoint:function(c){this.points.push(c)},appendPoints:function(c){this.points=this.points.concat(c)}},g.Intersection.intersectLineLine=function(c,a,b,f){var e,r=(f.x-b.x)*(c.y-b.y)-(f.y-b.y)*(c.x-b.x);e=(a.x-c.x)*(c.y-b.y)-(a.y-c.y)*(c.x-b.x);b=(f.y-b.y)*(a.x-c.x)-(f.x-b.x)*(a.y-c.y);0!==b?(r/=b,e/=b,0<=
r&&1>=r&&0<=e&&1>=e?(e=new d("Intersection"),e.points.push(new g.Point(c.x+r*(a.x-c.x),c.y+r*(a.y-c.y)))):e=new d):e=0===r||0===e?new d("Coincident"):new d("Parallel");return e},g.Intersection.intersectLinePolygon=function(c,a,b){for(var f=new d,e=b.length,g=0;g<e;g++){var h=d.intersectLineLine(c,a,b[g],b[(g+1)%e]);f.appendPoints(h.points)}0<f.points.length&&(f.status="Intersection");return f},g.Intersection.intersectPolygonPolygon=function(c,a){for(var b=new d,f=c.length,e=0;e<f;e++){var g=d.intersectLinePolygon(c[e],
c[(e+1)%f],a);b.appendPoints(g.points)}0<b.points.length&&(b.status="Intersection");return b},g.Intersection.intersectPolygonRectangle=function(c,a,b){var f=a.min(b),e=a.max(b);b=new g.Point(e.x,f.y);var r=new g.Point(f.x,e.y);a=d.intersectLinePolygon(f,b,c);b=d.intersectLinePolygon(b,e,c);e=d.intersectLinePolygon(e,r,c);c=d.intersectLinePolygon(r,f,c);f=new d;f.appendPoints(a.points);f.appendPoints(b.points);f.appendPoints(e.points);f.appendPoints(c.points);0<f.points.length&&(f.status="Intersection");
return f})})("undefined"!==typeof exports?exports:this);
(function(h){function d(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function g(a,b,f){0>f&&(f+=1);1<f&&--f;return f<1/6?a+6*(b-a)*f:.5>f?b:f<2/3?a+(b-a)*(2/3-f)*6:a}var c=h.fabric||(h.fabric={});c.Color?c.warn("fabric.Color is already defined."):(c.Color=d,c.Color.prototype={_tryParsingColor:function(a){var b;a in d.colorNameMap&&(a=d.colorNameMap[a]);"transparent"===a?this.setSource([255,255,255,0]):((b=d.sourceFromHex(a))||(b=d.sourceFromRgb(a)),b||(b=d.sourceFromHsl(a)),b&&this.setSource(b))},
_rgbToHsl:function(a,b,f){a/=255;b/=255;f/=255;var e,d,g,h=c.util.array.max([a,b,f]);d=c.util.array.min([a,b,f]);g=(h+d)/2;if(h===d)e=d=0;else{var y=h-d;d=.5<g?y/(2-h-d):y/(h+d);switch(h){case a:e=(b-f)/y+(b<f?6:0);break;case b:e=(f-a)/y+2;break;case f:e=(a-b)/y+4}e/=6}return[Math.round(360*e),Math.round(100*d),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=
this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),b,f;b=a[0].toString(16);b=1===b.length?"0"+b:b;f=a[1].toString(16);f=1===f.length?"0"+f:f;a=a[2].toString(16);a=1===a.length?"0"+a:a;return b.toUpperCase()+
f.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},toBlackWhite:function(a){var b=this.getSource(),f=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),b=b[3],f=Number(f)<Number(a||127)?0:255;this.setSource([f,f,f,b]);return this},overlayWith:function(a){a instanceof
d||(a=new d(a));var b=[],f=this.getAlpha(),e=this.getSource();a=a.getSource();for(var c=0;3>c;c++)b.push(Math.round(.5*e[c]+.5*a[c]));b[3]=f;this.setSource(b);return this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",
black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(a){return d.fromSource(d.sourceFromRgb(a))},c.Color.sourceFromRgb=function(a){if(a=a.match(d.reRGBa)){var b=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),f=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?
255:1),e=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(b,10),parseInt(f,10),parseInt(e,10),a[4]?parseFloat(a[4]):1]}},c.Color.fromRgba=d.fromRgb,c.Color.fromHsl=function(a){return d.fromSource(d.sourceFromHsl(a))},c.Color.sourceFromHsl=function(a){if(a=a.match(d.reHSLa)){var b=(parseFloat(a[1])%360+360)%360/360,f=parseFloat(a[2])/(/%$/.test(a[2])?100:1),e=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===f)e=f=b=e;else var c=.5>=e?e*(f+1):e+f-e*f,h=2*e-c,e=g(h,c,
b+1/3),f=g(h,c,b),b=g(h,c,b-1/3);return[Math.round(255*e),Math.round(255*f),Math.round(255*b),a[4]?parseFloat(a[4]):1]}},c.Color.fromHsla=d.fromHsl,c.Color.fromHex=function(a){return d.fromSource(d.sourceFromHex(a))},c.Color.sourceFromHex=function(a){if(a.match(d.reHex)){var b=a.slice(a.indexOf("#")+1),f=3===b.length;a=f?b.charAt(0)+b.charAt(0):b.substring(0,2);var e=f?b.charAt(1)+b.charAt(1):b.substring(2,4),b=f?b.charAt(2)+b.charAt(2):b.substring(4,6);return[parseInt(a,16),parseInt(e,16),parseInt(b,
16),1]}},c.Color.fromSource=function(a){var b=new d;b.setSource(a);return b})})("undefined"!==typeof exports?exports:this);
(function(){fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(h){h||(h={});var d={};this.id=fabric.Object.__uid++;this.type=h.type||"linear";d={x1:h.coords.x1||0,y1:h.coords.y1||0,x2:h.coords.x2||0,y2:h.coords.y2||0};"radial"===this.type&&(d.r1=h.coords.r1||0,d.r2=h.coords.r2||0);this.coords=d;this.colorStops=h.colorStops.slice();h.gradientTransform&&(this.gradientTransform=h.gradientTransform);this.offsetX=h.offsetX||this.offsetX;this.offsetY=h.offsetY||this.offsetY},
addColorStop:function(h){for(var d in h){var g=new fabric.Color(h[d]);this.colorStops.push({offset:d,color:g.toRgb(),opacity:g.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(h){var d=fabric.util.object.clone(this.coords),g;this.colorStops.sort(function(a,b){return a.offset-b.offset});if(!h.group||"path-group"!==h.group.type)for(var c in d)if("x1"===c||"x2"===c||"r2"===c)d[c]+=
this.offsetX-h.width/2;else if("y1"===c||"y2"===c)d[c]+=this.offsetY-h.height/2;h='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(h+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');"linear"===this.type?g=["<linearGradient ",h,' x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,'">\n']:"radial"===this.type&&(g=["<radialGradient ",h,' cx="',d.x2,'" cy="',d.y2,'" r="',d.r2,'" fx="',d.x1,'" fy="',d.y1,'">\n']);for(d=0;d<this.colorStops.length;d++)g.push("<stop ",
'offset="',100*this.colorStops[d].offset+"%",'" style="stop-color:',this.colorStops[d].color,null!=this.colorStops[d].opacity?";stop-opacity: "+this.colorStops[d].opacity:";",'"/>\n');g.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n");return g.join("")},toLive:function(h,d){var g,c,a=fabric.util.object.clone(this.coords);if(this.type){if(d.group&&"path-group"===d.group.type)for(c in a)if("x1"===c||"x2"===c)a[c]+=-this.offsetX+d.width/2;else if("y1"===c||"y2"===c)a[c]+=-this.offsetY+
d.height/2;"linear"===this.type?g=h.createLinearGradient(a.x1,a.y1,a.x2,a.y2):"radial"===this.type&&(g=h.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2));c=0;for(a=this.colorStops.length;c<a;c++){var b=this.colorStops[c].color,f=this.colorStops[c].opacity,e=this.colorStops[c].offset;"undefined"!==typeof f&&(b=(new fabric.Color(b)).setAlpha(f).toRgba());g.addColorStop(parseFloat(e),b)}return g}}});fabric.util.object.extend(fabric.Gradient,{forObject:function(h,d){d||(d={});var g=d.coords,c,a=0,
b=1,f;for(f in g){c=parseFloat(g[f],10);b="string"===typeof g[f]&&/^\d+%$/.test(g[f])?.01:1;if("x1"===f||"x2"===f||"r2"===f)b*=1,a=0;else if("y1"===f||"y2"===f)b*=1,a=0;g[f]=c*b+a}return new fabric.Gradient(d)}})})();
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.toFixed;d.Shadow?d.warn("fabric.Shadow is already defined."):(d.Shadow=d.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(c){"string"===typeof c&&(c=this._parseShadow(c));for(var a in c)this[a]=c[a];this.id=d.Object.__uid++},_parseShadow:function(c){c=c.trim();var a=d.Shadow.reOffsetsAndBlur.exec(c)||[];return{color:(c.replace(d.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),
offsetX:parseInt(a[1],10)||0,offsetY:parseInt(a[2],10)||0,blur:parseInt(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(c){var a=40,b=40;c.width&&c.height&&(a=100*g((Math.abs(this.offsetX)+this.blur)/c.width,2)+20,b=100*g((Math.abs(this.offsetY)+this.blur)/c.height,2)+20);return'<filter id="SVGID_'+this.id+'" y="-'+b+'%" height="'+(100+2*b)+'%" x="-'+a+'%" width="'+(100+2*a)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+
g(this.blur?this.blur/2:0,3)+'"></feGaussianBlur>\n\t<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var c={},a=d.Shadow.prototype;
this.color!==a.color&&(c.color=this.color);this.blur!==a.blur&&(c.blur=this.blur);this.offsetX!==a.offsetX&&(c.offsetX=this.offsetX);this.offsetY!==a.offsetY&&(c.offsetY=this.offsetY);return c}}),d.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof exports?exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var h=fabric.util.object.extend,d=fabric.util.getElementOffset,g=fabric.util.removeFromArray,c=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,
clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();this.interactive||this._initRetinaScaling();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));
b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},_initRetinaScaling:function(){1!==fabric.devicePixelRatio&&this.enableRetinaScaling&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},
calcOffset:function(){this._offset=d(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,f){return this.__setBgOverlayImage("overlayImage",a,b,f)},setBackgroundImage:function(a,b,f){return this.__setBgOverlayImage("backgroundImage",a,b,f)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();"undefined"!==typeof a.imageSmoothingEnabled?
a.imageSmoothingEnabled=this.imageSmoothingEnabled:(a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,a.mozImageSmoothingEnabled=this.imageSmoothingEnabled,a.msImageSmoothingEnabled=this.imageSmoothingEnabled,a.oImageSmoothingEnabled=this.imageSmoothingEnabled)},__setBgOverlayImage:function(a,b,f,e){"string"===typeof b?fabric.util.loadImage(b,function(b){this[a]=new fabric.Image(b,e);f&&f()},this,e&&e.crossOrigin):(e&&b.setOptions(e),this[a]=b,f&&f());return this},__setBgOverlayColor:function(a,
b,f){if(b&&b.source){var e=this;fabric.util.loadImage(b.source,function(c){e[a]=new fabric.Pattern({source:c,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});f&&f()})}else this[a]=b,f&&f();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");a.style||(a.style={});if(!a)throw c;this._initCanvasElement(a);return a},_initCanvasElement:function(a){fabric.util.createCanvasElement(a);if("undefined"===typeof a.getContext)throw c;},_initOptions:function(a){for(var b in a)this[b]=
a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);
fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var f;b=b||{};for(var e in a)f=a[e],b.cssOnly||(this._setBackstoreDimension(e,a[e]),f+="px"),
b.backstoreOnly||this._setCssDimension(e,f);this._setImageSmoothing();this.calcOffset();b.cssOnly||this.renderAll();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*
this.viewportTransform[3])},setViewportTransform:function(a){var b=this.getActiveGroup();this.viewportTransform=a;this.renderAll();a=0;for(var f=this._objects.length;a<f;a++)this._objects[a].setCoords();b&&b.setCoords();return this},zoomToPoint:function(a,b){var f=a;a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=b;var e=fabric.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=f.x-e.x;
this.viewportTransform[5]+=f.y-e.y;this.renderAll();f=0;for(e=this._objects.length;f<e;f++)this._objects[f].setCoords();return this},setZoom:function(a){this.zoomToPoint(new fabric.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},
getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var f=this.viewportTransform;a.transform(f[0],f[1],f[2],f[3],f[4],f[5]);this._shouldRenderObject(b)&&b.render(a);a.restore();this.controlsAboveOverlay||b._renderControls(a)}},_shouldRenderObject:function(a){return a?a!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(a){this.stateful&&a.setupState();a._set("canvas",
this);a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();
this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var b=this[!0===a&&this.interactive?"contextTop":"contextContainer"],f=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);a||this.clearContext(b);this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,
b);this._renderBackground(b);this._renderObjects(b,f);this._renderActiveGroup(b,f);this.clipTo&&b.restore();this._renderOverlay(b);this.controlsAboveOverlay&&this.interactive&&this.drawControls(b);this.fire("after:render");return this},_renderObjects:function(a,b){var f,e;if(!b||this.preserveObjectStacking)for(f=0,e=this._objects.length;f<e;++f)this._draw(a,this._objects[f]);else for(f=0,e=this._objects.length;f<e;++f)this._objects[f]&&!b.contains(this._objects[f])&&this._draw(a,this._objects[f])},
_renderActiveGroup:function(a,b){if(b){var f=[];this.forEachObject(function(a){b.contains(a)&&f.push(a)});b._set("_objects",f.reverse());this._draw(a,b)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&
(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(a,this.overlayImage)},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(a);this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(a){var b=this.getCenter();this._centerObject(a,new fabric.Point(b.left,b.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");
return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var f={objects:this._toObjects(a,b)};h(f,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,f,b);return f},_toObjects:function(a,b){return this.getObjects().map(function(f){return this._toObject(f,a,b)},this)},_toObject:function(a,b,f){var e;
this.includeDefaultValues||(e=a.includeDefaultValues,a.includeDefaultValues=!1);var c=this._realizeGroupTransformOnObject(a);b=a[b](f);this.includeDefaultValues||(a.includeDefaultValues=e);this._unwindGroupTransformOnObject(a,c);return b},_realizeGroupTransformOnObject:function(a){var b="angle flipX flipY height left scaleX scaleY top width".split(" ");if(a.group&&a.group===this.getActiveGroup()){var f={};b.forEach(function(e){f[e]=a[e]});this.getActiveGroup().realizeTransform(a);return f}return null},
_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},svgViewportTransformation:!0,toSVG:function(a,
b){a||(a={});var f=[];this._setSVGPreamble(f,a);this._setSVGHeader(f,a);this._setSVGBgOverlayColor(f,"backgroundColor");this._setSVGBgOverlayImage(f,"backgroundImage");this._setSVGObjects(f,b);this._setSVGBgOverlayColor(f,"overlayColor");this._setSVGBgOverlayImage(f,"overlayImage");f.push("</svg>");return f.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',
'"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var f,e,c;b.viewBox?(f=b.viewBox.width,e=b.viewBox.height):(f=this.width,e=this.height,this.svgViewportTransformation||(c=this.viewportTransform,f/=c[0],e/=c[3]));a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',f,'" ','height="',e,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':
null,b.viewBox?'viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,b){for(var f=0,e=this.getObjects(),c=e.length;f<c;f++){var d=e[f],g=this._realizeGroupTransformOnObject(d);a.push(d.toSVG(b));this._unwindGroupTransformOnObject(d,g)}},_setSVGBgOverlayImage:function(a,
b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,
'" height="',this.height,'" fill="',this[b],'"',"></rect>")},sendToBack:function(a){g(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){g(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var f=this._objects.indexOf(a);0!==f&&(f=this._findNewLowerIndex(a,f,b),g(this._objects,a),this._objects.splice(f,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,
f){if(f)for(f=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){f=b;break}}else f=b-1;return f},bringForward:function(a,b){var f=this._objects.indexOf(a);f!==this._objects.length-1&&(f=this._findNewUpperIndex(a,f,b),g(this._objects,a),this._objects.splice(f,0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,b,f){if(f)for(f=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||
a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){f=b;break}}else f=b+1;return f},moveTo:function(a,b){g(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});h(fabric.StaticCanvas.prototype,fabric.Observable);h(fabric.StaticCanvas.prototype,
fabric.Collection);h(fabric.StaticCanvas.prototype,fabric.DataURLExporter);h(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var f=b.getContext("2d");if(!f)return null;switch(a){case "getImageData":return"undefined"!==typeof f.getImageData;case "setLineDash":return"undefined"!==typeof f.setLineDash;case "toDataURL":return"undefined"!==typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",
0),!0}catch(e){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
(function(){var h=fabric.util.getPointer,d=fabric.util.degreesToRadians,g=fabric.util.radiansToDegrees,c=Math.atan2,a=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,e){e||(e={});this._initStatic(a,e);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",
selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);
this.calcOffset()},_resetCurrentTransform:function(a){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,left:e.original.left,top:e.original.top});this._shouldCenterTransform(a,e.target)?"rotate"===e.action?this._setOriginToCenter(e.target):("center"!==e.originX&&(e.mouseXSign="right"===e.originX?-1:1),"center"!==e.originY&&(e.mouseYSign="bottom"===e.originY?-1:1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},
containsPoint:function(a,e){var b=this.getPointer(a,!0),c=this._normalizePointer(e,b);return e.containsPoint(c)||e._findTargetCorner(b)},_normalizePointer:function(a,e){var b=this.getActiveGroup(),c=e.x,d=e.y,g;b&&"group"!==a.type&&b.contains(a)&&(g=fabric.util.transformPoint(b.getCenterPoint(),this.viewportTransform,!0),c-=g.x,d-=g.y,c/=b.scaleX,d/=b.scaleY);return{x:c,y:d}},isTargetTransparent:function(a,e,b){var c=a.hasBorders,d=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;this._draw(this.contextCache,
a);a.hasBorders=c;a.transparentCorners=d;a=fabric.util.isTransparent(this.contextCache,e,b,this.targetFindTolerance);this.clearContext(this.contextCache);return a},_shouldClearSelection:function(a,e){var b=this.getActiveGroup(),c=this.getActiveObject();return!e||e&&b&&!b.contains(e)&&b!==e&&!a.shiftKey||e&&!e.evented||e&&!e.selectable&&c&&c!==e},_shouldCenterTransform:function(a,e){if(e){var b=this._currentTransform,c;"scale"===b.action||"scaleX"===b.action||"scaleY"===b.action?c=this.centeredScaling||
e.centeredScaling:"rotate"===b.action&&(c=this.centeredRotation||e.centeredRotation);return c?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,e){var b={x:a.originX,y:a.originY};if("ml"===e||"tl"===e||"bl"===e)b.x="right";else if("mr"===e||"tr"===e||"br"===e)b.x="left";if("tl"===e||"mt"===e||"tr"===e)b.y="bottom";else if("bl"===e||"mb"===e||"br"===e)b.y="top";return b},_getActionFromCorner:function(a,e){var b="drag";e&&(b="ml"===e||"mr"===e?"scaleX":"mt"===e||"mb"===e?"scaleY":"mtr"===e?"rotate":
"scale");return b},_setupCurrentTransform:function(a,e){if(e){var b=this.getPointer(a),c=e._findTargetCorner(this.getPointer(a,!0)),g=this._getActionFromCorner(e,c),c=this._getOriginFromCorner(e,c);this._currentTransform={target:e,action:g,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:b.x-e.left,offsetY:b.y-e.top,originX:c.x,originY:c.y,ex:b.x,ey:b.y,left:e.left,top:e.top,theta:d(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,
scaleY:e.scaleY,originX:c.x,originY:c.y};this._resetCurrentTransform(a)}},_translateObject:function(a,e){var b=this._currentTransform.target;b.get("lockMovementX")||b.set("left",a-this._currentTransform.offsetX);b.get("lockMovementY")||b.set("top",e-this._currentTransform.offsetY)},_scaleObject:function(a,e,b){var c=this._currentTransform,d=c.target,g=d.get("lockScalingX"),h=d.get("lockScalingY"),A=d.get("lockScalingFlip");if(!g||!h){var C=d.translateToOriginPoint(d.getCenterPoint(),c.originX,c.originY);
a=d.toLocalPoint(new fabric.Point(a,e),c.originX,c.originY);this._setLocalMouse(a,c);this._setObjectScale(a,c,g,h,b,A);d.setPositionByOrigin(C,c.originX,c.originY)}},_setObjectScale:function(a,e,b,c,d,g){var h=e.target,A=!1,C=!1,p=h._getNonTransformedDimensions();e.newScaleX=a.x/p.x;e.newScaleY=a.y/p.y;g&&0>=e.newScaleX&&e.newScaleX<h.scaleX&&(A=!0);g&&0>=e.newScaleY&&e.newScaleY<h.scaleY&&(C=!0);"equally"!==d||b||c?d?"x"!==d||h.get("lockUniScaling")?"y"!==d||h.get("lockUniScaling")||C||c||h.set("scaleY",
e.newScaleY):A||b||h.set("scaleX",e.newScaleX):(A||b||h.set("scaleX",e.newScaleX),C||c||h.set("scaleY",e.newScaleY)):A||C||this._scaleObjectEqually(a,h,e);A||C||this._flipObject(e,d)},_scaleObjectEqually:function(a,e,b){a=a.y+a.x;var c=e._getNonTransformedDimensions(),c=c.y*b.original.scaleY+c.x*b.original.scaleX;b.newScaleX=b.original.scaleX*a/c;b.newScaleY=b.original.scaleY*a/c;e.set("scaleX",b.newScaleX);e.set("scaleY",b.newScaleY)},_flipObject:function(a,e){0>a.newScaleX&&"y"!==e&&("left"===a.originX?
a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&"x"!==e&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(f,e){var b=e.target;"right"===e.originX?f.x*=-1:"center"===e.originX&&(f.x=2*f.x*e.mouseXSign,0>f.x&&(e.mouseXSign=-e.mouseXSign));"bottom"===e.originY?f.y*=-1:"center"===e.originY&&(f.y=2*f.y*e.mouseYSign,0>f.y&&(e.mouseYSign=-e.mouseYSign));a(f.x)>b.padding?f.x=0>f.x?f.x+b.padding:f.x-b.padding:f.x=0;a(f.y)>b.padding?
f.y=0>f.y?f.y+b.padding:f.y-b.padding:f.y=0},_rotateObject:function(a,e){var b=this._currentTransform;if(!b.target.get("lockRotation")){var d=c(b.ey-b.top,b.ex-b.left),h=c(e-b.top,a-b.left),d=g(h-d+b.theta);0>d&&(d=360+d);b.target.angle=d%360}},setCursor:function(a){},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.setAngle(0)},_drawSelection:function(){var f=this.contextTop,e=this._groupSelector,b=e.left,c=e.top,d=a(b),g=a(c);f.fillStyle=this.selectionColor;f.fillRect(e.ex-(0<b?0:-b),e.ey-
(0<c?0:-c),d,g);f.lineWidth=this.selectionLineWidth;f.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(b=e.ex+.5-(0<b?0:d),e=e.ey+.5-(0<c?0:g),f.beginPath(),fabric.util.drawDashedLine(f,b,e,b+d,e,this.selectionDashArray),fabric.util.drawDashedLine(f,b,e+g-1,b+d,e+g-1,this.selectionDashArray),fabric.util.drawDashedLine(f,b,e,b,e+g,this.selectionDashArray),fabric.util.drawDashedLine(f,b+d-1,e,b+d-1,e+g,this.selectionDashArray),f.closePath(),f.stroke()):f.strokeRect(e.ex+.5-(0<
b?0:d),e.ey+.5-(0<c?0:g),d,g)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,!0))},findTarget:function(a,e){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;
var b=this.getActiveGroup();if(b&&!e&&this.containsPoint(a,b))return b;b=this._searchPossibleTargets(a,e);this._fireOverOutEvents(b,a);return b}},_fireOverOutEvents:function(a,b){a?this._hoveredTarget!==a&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:b}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:a,e:b}),a.fire("mouseover"),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:b}),this._hoveredTarget.fire("mouseout"),
this._hoveredTarget=null)},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,b)&&(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing||!this.isTargetTransparent(b,c.x,c.y)))return!0},_searchPossibleTargets:function(a,b){for(var c,d=this.getPointer(a,!0),g=this._objects.length;g--;)if((!this._objects[g].group||b)&&this._checkTarget(a,this._objects[g],d)){this.relatedTarget=this._objects[g];c=this._objects[g];break}return c},getPointer:function(a,b,c){c||(c=this.upperCanvasEl);
a=h(a);var d=c.getBoundingClientRect(),g=d.width||0,y=d.height||0;g&&y||("top"in d&&"bottom"in d&&(y=Math.abs(d.top-d.bottom)),"right"in d&&"left"in d&&(g=Math.abs(d.right-d.left)));this.calcOffset();a.x-=this._offset.left;a.y-=this._offset.top;b||(a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform)));0===g||0===y?c=b=1:(b=c.width/g,c=c.height/y);return{x:a.x*b,y:a.y*c}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");
this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=
this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0});
a.width=b;a.height=c;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},setActiveObject:function(a,b){this._setActiveObject(a);this.renderAll();this.fire("object:selected",{target:a,e:b});a.fire("selected",{e:b});
return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",!0)},setActiveGroup:function(a,b){this._setActiveGroup(a);a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}));
return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;b<c;b++)a[b].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||
this.getActiveObject();b&&this.fire("before:selection:cleared",{target:b,e:a});this.deactivateAll();b&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var b=this.getActiveGroup();b?this._drawGroupControls(a,b):this._drawObjectsControls(a)},_drawGroupControls:function(a,b){b._renderControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;b<c;++b)this._objects[b]&&this._objects[b].active&&(this._objects[b]._renderControls(a),this.lastRenderedObjectWithControlsAboveOverlay=
this._objects[b])}});for(var b in fabric.StaticCanvas)"prototype"!==b&&(fabric.Canvas[b]=fabric.StaticCanvas[b]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){var h={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},d=fabric.util.addListener,g=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();d(fabric.window,"resize",this._onResize);d(this.upperCanvasEl,"mousedown",this._onMouseDown);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"mousewheel",this._onMouseWheel);
d(this.upperCanvasEl,"touchstart",this._onMouseDown);d(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);
this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){g(fabric.window,"resize",this._onResize);g(this.upperCanvasEl,"mousedown",
this._onMouseDown);g(this.upperCanvasEl,"mousemove",this._onMouseMove);g(this.upperCanvasEl,"mousewheel",this._onMouseWheel);g(this.upperCanvasEl,"touchstart",this._onMouseDown);g(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,
"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(c,a){this.__onTransformGesture&&this.__onTransformGesture(c,a)},_onDrag:function(c,a){this.__onDrag&&this.__onDrag(c,a)},_onMouseWheel:function(c,a){this.__onMouseWheel&&this.__onMouseWheel(c,a)},_onOrientationChange:function(c,a){this.__onOrientationChange&&this.__onOrientationChange(c,a)},_onShake:function(c,a){this.__onShake&&this.__onShake(c,a)},_onLongPress:function(c,a){this.__onLongPress&&
this.__onLongPress(c,a)},_onMouseDown:function(c){this.__onMouseDown(c);d(fabric.document,"touchend",this._onMouseUp);d(fabric.document,"touchmove",this._onMouseMove);g(this.upperCanvasEl,"mousemove",this._onMouseMove);g(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===c.type?g(this.upperCanvasEl,"mousedown",this._onMouseDown):(d(fabric.document,"mouseup",this._onMouseUp),d(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(c){this.__onMouseUp(c);g(fabric.document,
"mouseup",this._onMouseUp);g(fabric.document,"touchend",this._onMouseUp);g(fabric.document,"mousemove",this._onMouseMove);g(fabric.document,"touchmove",this._onMouseMove);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"touchmove",this._onMouseMove);if("touchend"===c.type){var a=this;setTimeout(function(){d(a.upperCanvasEl,"mousedown",a._onMouseDown)},400)}},_onMouseMove:function(c){!this.allowTouchScrolling&&c.preventDefault&&c.preventDefault();this.__onMouseMove(c)},_onResize:function(){this.calcOffset()},
_shouldRender:function(c,a){var b=this.getActiveGroup()||this.getActiveObject();return!!(c&&(c.isMoving||c!==b)||!c&&b||!c&&!b&&!this._groupSelector||a&&this._previousPointer&&this.selection&&(a.x!==this._previousPointer.x||a.y!==this._previousPointer.y))},__onMouseUp:function(c){var a;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(c);else{this._currentTransform?(this._finalizeCurrentTransform(),a=this._currentTransform.target):a=this.findTarget(c,!0);var b=this._shouldRender(a,
this.getPointer(c));this._maybeGroupObjects(c);a&&(a.isMoving=!1);b&&this.renderAll();this._handleCursorAndEvent(c,a)}},_handleCursorAndEvent:function(c,a){this._setCursorFromEvent(c,a);var b=this;setTimeout(function(){b._setCursorFromEvent(c,a)},50);this.fire("mouse:up",{target:a,e:c});a&&a.fire("mouseup",{e:c})},_finalizeCurrentTransform:function(){var c=this._currentTransform.target;c._scaling&&(c._scaling=!1);c.setCoords();this.stateful&&c.hasStateChanged()&&(this.fire("object:modified",{target:c}),
c.fire("modified"));this._restoreOriginXY(c)},_restoreOriginXY:function(c){if(this._previousOriginX&&this._previousOriginY){var a=c.translateToOriginPoint(c.getCenterPoint(),this._previousOriginX,this._previousOriginY);c.originX=this._previousOriginX;c.originY=this._previousOriginY;c.left=a.x;c.top=a.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(c){this._isCurrentlyDrawing=!0;this.discardActiveObject(c).renderAll();this.clipTo&&fabric.util.clipContext(this,
this.contextTop);var a=fabric.util.invertTransform(this.viewportTransform),a=fabric.util.transformPoint(this.getPointer(c,!0),a);this.freeDrawingBrush.onMouseDown(a);this.fire("mouse:down",{e:c});a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mousedown",{e:c,target:a})},_onMouseMoveInDrawingMode:function(c){if(this._isCurrentlyDrawing){var a=fabric.util.invertTransform(this.viewportTransform),a=fabric.util.transformPoint(this.getPointer(c,!0),a);this.freeDrawingBrush.onMouseMove(a)}this.setCursor(this.freeDrawingCursor);
this.fire("mouse:move",{e:c});a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mousemove",{e:c,target:a})},_onMouseUpInDrawingMode:function(c){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:c});var a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mouseup",{e:c,target:a})},__onMouseDown:function(c){if(("which"in c?1===c.which:1===c.button)||fabric.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(c);
else if(!this._currentTransform){var a=this.findTarget(c),b=this.getPointer(c,!0);this._previousPointer=b;var f=this._shouldRender(a,b),e=this._shouldGroup(c,a);this._shouldClearSelection(c,a)?this._clearSelection(c,a,b):e&&(this._handleGrouping(c,a),a=this.getActiveGroup());a&&a.selectable&&!e&&(this._beforeTransform(c,a),this._setupCurrentTransform(c,a));f&&this.renderAll();this.fire("mouse:down",{target:a,e:c});a&&a.fire("mousedown",{e:c})}},_beforeTransform:function(c,a){this.stateful&&a.saveState();
if(a._findTargetCorner(this.getPointer(c)))this.onBeforeScaleRotate(a);a!==this.getActiveGroup()&&a!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(a,c))},_clearSelection:function(c,a,b){this.deactivateAllWithDispatch(c);a&&a.selectable?this.setActiveObject(a,c):this.selection&&(this._groupSelector={ex:b.x,ey:b.y,top:0,left:0})},_setOriginToCenter:function(c){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;
var a=c.getCenterPoint();c.originX="center";c.originY="center";c.left=a.x;c.top=a.y;this._currentTransform.left=c.left;this._currentTransform.top=c.top},_setCenterToOrigin:function(c){var a=c.translateToOriginPoint(c.getCenterPoint(),this._previousOriginX,this._previousOriginY);c.originX=this._previousOriginX;c.originY=this._previousOriginY;c.left=a.x;c.top=a.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(c){var a,b;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(c);
else if(!("undefined"!==typeof c.touches&&1<c.touches.length)){var f=this._groupSelector;f?(b=this.getPointer(c,!0),f.left=b.x-f.ex,f.top=b.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(c):(a=this.findTarget(c),!a||a&&!a.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(c,a));this.fire("mouse:move",{target:a,e:c});a&&a.fire("mousemove",{e:c})}},_transformObject:function(c){var a=this.getPointer(c),b=this._currentTransform;b.reset=!1;b.target.isMoving=!0;
this._beforeScaleTransform(c,b);this._performTransformAction(c,b,a);this.renderAll()},_performTransformAction:function(c,a,b){var f=b.x;b=b.y;var e=a.target,d=a.action;"rotate"===d?(this._rotateObject(f,b),this._fire("rotating",e,c)):"scale"===d?(this._onScale(c,a,f,b),this._fire("scaling",e,c)):"scaleX"===d?(this._scaleObject(f,b,"x"),this._fire("scaling",e,c)):"scaleY"===d?(this._scaleObject(f,b,"y"),this._fire("scaling",e,c)):(this._translateObject(f,b),this._fire("moving",e,c),this.setCursor(this.moveCursor))},
_fire:function(c,a,b){this.fire("object:"+c,{target:a,e:b});a.fire(c,{e:b})},_beforeScaleTransform:function(c,a){if("scale"===a.action||"scaleX"===a.action||"scaleY"===a.action){var b=this._shouldCenterTransform(c,a.target);if(b&&("center"!==a.originX||"center"!==a.originY)||!b&&"center"===a.originX&&"center"===a.originY)this._resetCurrentTransform(c),a.reset=!0}},_onScale:function(c,a,b,f){!c.shiftKey&&!this.uniScaleTransform||a.target.get("lockUniScaling")?(a.reset||"scale"!==a.currentAction||this._resetCurrentTransform(c,
a.target),a.currentAction="scaleEqually",this._scaleObject(b,f,"equally")):(a.currentAction="scale",this._scaleObject(b,f))},_setCursorFromEvent:function(c,a){if(a&&a.selectable){var b=this.getActiveGroup();(b=a._findTargetCorner&&(!b||!b.contains(a))&&a._findTargetCorner(this.getPointer(c,!0)))?this._setCornerCursor(b,a):this.setCursor(a.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),!1;return!0},_setCornerCursor:function(c,a){if(c in h)this.setCursor(this._getRotatedCornerCursor(c,
a));else if("mtr"===c&&a.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(c,a){var b=Math.round(a.getAngle()%360/45);0>b&&(b+=8);b+=h[c];return this.cursorMap[b%8]}})})();
(function(){var h=Math.min,d=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(d,c){var a=this.getActiveObject();return d.shiftKey&&(this.getActiveGroup()||a&&a!==c)&&this.selection},_handleGrouping:function(d,c){if(c===this.getActiveGroup()&&(c=this.findTarget(d,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,d):this._createActiveGroup(c,d);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(d,c){var a=this.getActiveGroup();
if(a.contains(d)){if(a.removeWithUpdate(d),this._resetObjectTransform(a),d.set("active",!1),1===a.size()){this.discardActiveGroup(c);this.setActiveObject(a.item(0));return}}else a.addWithUpdate(d),this._resetObjectTransform(a);this.fire("selection:created",{target:a,e:c});a.set("active",!0)},_createActiveGroup:function(d,c){if(this._activeObject&&d!==this._activeObject){var a=this._createGroup(d);a.addWithUpdate();this.setActiveGroup(a);this._activeObject=null;this.fire("selection:created",{target:a,
e:c})}d.set("active",!0)},_createGroup:function(d){var c=this.getObjects();d=c.indexOf(this._activeObject)<c.indexOf(d)?[this._activeObject,d]:[d,this._activeObject];return new fabric.Group(d,{canvas:this})},_groupSelectedObjects:function(d){var c=this._collectObjects();1===c.length?this.setActiveObject(c[0],d):1<c.length&&(c=new fabric.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,d),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){var g=
[],c;c=this._groupSelector.ex;for(var a=this._groupSelector.ey,b=c+this._groupSelector.left,f=a+this._groupSelector.top,e=new fabric.Point(h(c,b),h(a,f)),r=new fabric.Point(d(c,b),d(a,f)),a=c===b&&a===f,b=this._objects.length;b--&&!((c=this._objects[b])&&c.selectable&&c.visible&&(c.intersectsWithRect(e,r)||c.isContainedWithinRect(e,r)||c.containsPoint(e)||c.containsPoint(r))&&(c.set("active",!0),g.push(c),a)););return g},_maybeGroupObjects:function(d){this.selection&&this._groupSelector&&this._groupSelectedObjects(d);
if(d=this.getActiveGroup())d.setObjectsCoords().setCoords(),d.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(h){h||(h={});var d=h.format||"png",g=h.quality||1,c=h.multiplier||1;h={left:h.left,top:h.top,width:h.width,height:h.height};return 1!==c?this.__toDataURLWithMultiplier(d,g,h,c):this.__toDataURL(d,g,h)},__toDataURL:function(h,d,g){this.renderAll(!0);var c=this.upperCanvasEl||this.lowerCanvasEl;g=this.__getCroppedCanvas(c,g);"jpg"===h&&(h="jpeg");h=fabric.StaticCanvas.supports("toDataURLWithQuality")?(g||c).toDataURL("image/"+
h,d):(g||c).toDataURL("image/"+h);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return h},__getCroppedCanvas:function(h,d){var g,c;if("left"in d||"top"in d||"width"in d||"height"in d)g=fabric.util.createCanvasElement(),c=g.getContext("2d"),g.width=d.width||this.width,g.height=d.height||this.height,c.drawImage(h,-d.left||0,-d.top||0);return g},__toDataURLWithMultiplier:function(h,d,g,c){var a=this.getWidth(),b=this.getHeight(),f=a*c,e=b*c,r=this.getActiveObject(),v=this.getActiveGroup(),
t=this.contextTop||this.contextContainer;1<c&&this.setWidth(f).setHeight(e);t.scale(c,c);g.left&&(g.left*=c);g.top&&(g.top*=c);g.width?g.width*=c:1>c&&(g.width=f);g.height?g.height*=c:1>c&&(g.height=e);v?this._tempRemoveBordersControlsFromGroup(v):r&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);h=this.__toDataURL(h,d,g);this.width=a;this.height=b;t.scale(1/c,1/c);this.setWidth(a).setHeight(b);v?this._restoreBordersControlsOnGroup(v):r&&this.setActiveObject&&this.setActiveObject(r);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return h},toDataURLWithMultiplier:function(h,d,g){return this.toDataURL({format:h,multiplier:d,quality:g})},_tempRemoveBordersControlsFromGroup:function(h){h.origHasControls=h.hasControls;h.origBorderColor=h.borderColor;h.hasControls=!0;h.borderColor="rgba(0,0,0,0)";h.forEachObject(function(d){d.origBorderColor=d.borderColor;d.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(h){h.hideControls=h.origHideControls;
h.borderColor=h.origBorderColor;h.forEachObject(function(d){d.borderColor=d.origBorderColor;delete d.origBorderColor})}});
(function(h){var d=h.fabric||(h.fabric={});h=d.util.object.extend;var g=d.util.toFixed,c=d.util.string.capitalize,a=d.util.degreesToRadians,b=d.StaticCanvas.supports("setLineDash");d.Object||(d.Object=d.util.createClass({type:"object",originX:"center",originY:"center",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,
centeredRotation:!0,fill:null,fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,
lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor alignX alignY meetOrSlice".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||!a.fill.colorStops||a.fill instanceof
d.Gradient||this.set("fill",new d.Gradient(a.fill));!a.stroke||!a.stroke.colorStops||a.stroke instanceof d.Gradient||this.set("stroke",new d.Gradient(a.stroke))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof d.Pattern||this.set("fill",new d.Pattern(a.fill));!a.stroke||!a.stroke.source||a.stroke instanceof d.Pattern||this.set("stroke",new d.Pattern(a.stroke))},_initClipping:function(a){a.clipTo&&"string"===typeof a.clipTo&&(a=d.util.getFunctionBody(a.clipTo),"undefined"!==typeof a&&
(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(b,e){this.group&&this.canvas&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup&&this.group.transform(b);var c=e?this._getLeftTopCoords():this.getCenterPoint();b.translate(c.x,c.y);0!=this.angle&&b.rotate(a(this.angle));1==this.scaleX&&1==this.scaleY||b.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*
(this.flipY?-1:1))},toObject:function(a){var b=d.Object.NUM_FRACTION_DIGITS,b={type:this.type,originX:this.originX,originY:this.originY,left:g(this.left,b),top:g(this.top,b),width:g(this.width,b),height:g(this.height,b),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:g(this.strokeWidth,b),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,
strokeMiterLimit:g(this.strokeMiterLimit,b),scaleX:g(this.scaleX,b),scaleY:g(this.scaleY,b),angle:g(this.getAngle(),b),flipX:this.flipX,flipY:this.flipY,opacity:g(this.opacity,b),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix};this.includeDefaultValues||(b=this._removeDefaultValues(b));
d.util.populateWithProperties(this,b,a);return b},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var b=d.util.getKlass(a.type).prototype;b.stateProperties.forEach(function(c){a[c]===b[c]&&delete a[c];"[object Array]"===Object.prototype.toString.call(a[c])&&"[object Array]"===Object.prototype.toString.call(b[c])&&0===a[c].length&&0===b[c].length&&delete a[c]});return a},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,
a[b])},set:function(a,b){"object"===typeof a?this._setObject(a):"function"===typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(a,b){if("scaleX"===a||"scaleY"===a)b=this._constrainScale(b);"scaleX"===a&&0>b?(this.flipX=!this.flipX,b*=-1):"scaleY"===a&&0>b?(this.flipY=!this.flipY,b*=-1):"width"===a||"height"===a?this.minScaleLimit=g(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==a||!b||b instanceof d.Shadow||(b=new d.Shadow(b));this[a]=b;return this},
setOnGroup:function(){},toggle:function(a){var b=this.get(a);"boolean"===typeof b&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(a,b){0===this.width&&0===this.height||!this.visible||(a.save(),this._setupCompositeOperation(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&a.transform.apply(a,
this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&d.util.clipContext(this,a),this._render(a,b),this.clipTo&&a.restore(),a.restore())},_setOpacity:function(a){1!=this.opacity&&(this.group&&this.group._setOpacity(a),a.globalAlpha*=this.opacity)},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},
_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_renderControls:function(a,b){},_setShadow:function(a){if(this.shadow){var b=this.canvas&&this.canvas.viewportTransform[0]||1,c=this.canvas&&this.canvas.viewportTransform[3]||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*(b+c)*(this.scaleX+this.scaleY)/4;a.shadowOffsetX=this.shadow.offsetX*b*this.scaleX;a.shadowOffsetY=this.shadow.offsetY*c*this.scaleY}},_removeShadow:function(a){this.shadow&&
(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&(a.save(),this.fill.gradientTransform&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this.strokeDashArray?
(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),b?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?this._stroke(a):a.stroke()),a.restore())},clone:function(a,b){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(b),a):new d.Object(this.toObject(b))},
cloneAsImage:function(a){var b=this.toDataURL();d.util.loadImage(b,function(b){a&&a(new d.Image(b))});return this},toDataURL:function(a){a||(a={});var b=d.util.createCanvasElement(),c=this.getBoundingRect();b.width=c.width;b.height=c.height;d.util.wrapElement(b,"div");c=new d.StaticCanvas(b);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(c.backgroundColor="#fff");var g={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new d.Point(b.width/
2,b.height/2),"center","center");b=this.canvas;c.add(this);a=c.toDataURL(a);this.set(g).setCoords();this.canvas=b;c.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,b){b||(b={});var c={colorStops:[]};c.type=b.type||(b.r1||b.r2?"radial":"linear");c.coords={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};if(b.r1||b.r2)c.coords.r1=b.r1,c.coords.r2=b.r2;for(var g in b.colorStops){var h=new d.Color(b.colorStops[g]);
c.colorStops.push({offset:g,color:h.toRgb(),opacity:h.getAlpha()})}return this.set(a,d.Gradient.forObject(this,c))},setPatternFill:function(a){return this.set("fill",new d.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new d.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;b&&this._setOriginToCenter();this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);
return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var c=new d.Point(b.x,b.y),g=this._getLeftTopCoords();this.angle&&(c=d.util.rotatePoint(c,g,d.util.degreesToRadians(-this.angle)));return{x:c.x-g.x,y:c.y-g.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=
this.globalCompositeOperation)}}),d.util.createAccessors(d.Object),d.Object.prototype.rotate=d.Object.prototype.setAngle,h(d.Object.prototype,d.Observable),d.Object.NUM_FRACTION_DIGITS=2,d.Object.__uid=0)})("undefined"!==typeof exports?exports:this);
(function(){var h=fabric.util.degreesToRadians,d={left:-.5,center:0,right:.5},g={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(c,a,b,f,e){var h=c.x,v=c.y;a=d[f]-d[a];b=g[e]-g[b];if(a||b)v=this._getTransformedDimensions(),h=c.x+a*v.x,v=c.y+b*v.y;return new fabric.Point(h,v)},translateToCenterPoint:function(c,a,b){a=this.translateToGivenOrigin(c,a,b,"center","center");return this.angle?fabric.util.rotatePoint(a,c,h(this.angle)):a},translateToOriginPoint:function(c,
a,b){a=this.translateToGivenOrigin(c,"center","center",a,b);return this.angle?fabric.util.rotatePoint(a,c,h(this.angle)):a},getCenterPoint:function(){var c=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(c,this.originX,this.originY)},getPointByOrigin:function(c,a){var b=this.getCenterPoint();return this.translateToOriginPoint(b,c,a)},toLocalPoint:function(c,a,b){var d=this.getCenterPoint();a=a&&b?this.translateToGivenOrigin(d,"center","center",a,b):new fabric.Point(this.left,
this.top);c=new fabric.Point(c.x,c.y);this.angle&&(c=fabric.util.rotatePoint(c,d,-h(this.angle)));return c.subtractEquals(a)},setPositionByOrigin:function(c,a,b){c=this.translateToCenterPoint(c,a,b);c=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",c.x);this.set("top",c.y)},adjustPosition:function(c){var a=h(this.angle),b=this.getWidth(),f=Math.cos(a)*b,a=Math.sin(a)*b;this.left+=f*(d[c]-d[this.originX]);this.top+=a*(d[c]-d[this.originX]);this.setCoords();this.originX=c},
_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var c=this.getCenterPoint();this.originY=this.originX="center";this.left=c.x;this.top=c.y},_resetOrigin:function(){var c=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=c.x;this.top=c.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),
"left","top")}})})();
(function(){function h(d){return[new fabric.Point(d.tl.x,d.tl.y),new fabric.Point(d.tr.x,d.tr.y),new fabric.Point(d.br.x,d.br.y),new fabric.Point(d.bl.x,d.bl.y)]}fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(d,g){var c=h(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(c,d,g).status},intersectsWithObject:function(d){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(h(this.oCoords),h(d.oCoords)).status},
isContainedWithinObject:function(d){var g=d.getBoundingRect();d=new fabric.Point(g.left,g.top);g=new fabric.Point(g.left+g.width,g.top+g.height);return this.isContainedWithinRect(d,g)},isContainedWithinRect:function(d,g){var c=this.getBoundingRect();return c.left>=d.x&&c.left+c.width<=g.x&&c.top>=d.y&&c.top+c.height<=g.y},containsPoint:function(d){if(this.oCoords){var g=this._getImageLines(this.oCoords);d=this._findCrossPoints(d,g);return 0!==d&&1===d%2}return!1},_getImageLines:function(d){return{topline:{o:d.tl,
d:d.tr},rightline:{o:d.tr,d:d.br},bottomline:{o:d.br,d:d.bl},leftline:{o:d.bl,d:d.tl}}},_findCrossPoints:function(d,g){var c,a,b,f=0,e;for(e in g)if(b=g[e],!(b.o.y<d.y&&b.d.y<d.y||b.o.y>=d.y&&b.d.y>=d.y)&&(b.o.x===b.d.x&&b.o.x>=d.x?c=b.o.x:(c=(b.d.y-b.o.y)/(b.d.x-b.o.x),a=d.y-0*d.x,b=b.o.y-c*b.o.x,c=-(a-b)/(0-c)),c>=d.x&&(f+=1),2===f))break;return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||
this.setCoords();var d=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],g=fabric.util.array.min(d),d=fabric.util.array.max(d),d=Math.abs(g-d),c=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],a=fabric.util.array.min(c),c=fabric.util.array.max(c),c=Math.abs(a-c);return{left:g,top:a,width:d,height:c}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(d){return Math.abs(d)<
this.minScaleLimit?0>d?-this.minScaleLimit:this.minScaleLimit:d},scale:function(d){d=this._constrainScale(d);0>d&&(this.flipX=!this.flipX,this.flipY=!this.flipY,d*=-1);this.scaleY=this.scaleX=d;this.setCoords();return this},scaleToWidth:function(d){var g=this.getBoundingRect().width/this.getWidth();return this.scale(d/this.width/g)},scaleToHeight:function(d){var g=this.getBoundingRect().height/this.getHeight();return this.scale(d/this.height/g)},setCoords:function(){var d=this._calculateCurrentDimensions(),
g=d.x,c=d.y;0>g&&(g=Math.abs(g));var d=0<g?Math.atan(c/g):0,a=g/Math.cos(d)/2,b=Math.cos(d)*a,a=Math.sin(d)*a,f=this.getCenterPoint(),d=new fabric.Point(f.x-b,f.y-a),g=new fabric.Point(d.x+g,d.y),c=new fabric.Point(d.x,d.y+c),b=new fabric.Point(f.x+b,f.y+a),a=new fabric.Point((d.x+c.x)/2,(d.y+c.y)/2),f=new fabric.Point((g.x+d.x)/2,(g.y+d.y)/2),e=new fabric.Point((b.x+g.x)/2,(b.y+g.y)/2),h=new fabric.Point((b.x+c.x)/2,(b.y+c.y)/2),v=new fabric.Point(f.x,f.y-this.rotatingPointOffset);this.oCoords={tl:d,
tr:g,br:b,bl:c,ml:a,mt:f,mr:e,mb:h,mtr:v};return this},_calcDimensionsTransformMatrix:function(){return[this.scaleX,0,0,this.scaleY,0,0]}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(h){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,h):this.canvas.sendBackwards(this,h);return this},bringForward:function(h){this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,h):this.canvas.bringForward(this,h);return this},moveTo:function(h){this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,h):this.canvas.moveTo(this,h);return this}});
fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var h=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",d=this.fillRule,g=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",c=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none";return["stroke: ",g,"; stroke-width: ",c,"; stroke-dasharray: ",a,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",
this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",h,"; fill-rule: ",d,"; opacity: ","undefined"!==typeof this.opacity?this.opacity:"1",";",this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var h=fabric.util.toFixed,d=this.getAngle(),g=!this.canvas||this.canvas.svgViewportTransformation?
this.getViewportTransform():[1,0,0,1,0,0],c=fabric.util.transformPoint(this.getCenterPoint(),g),a=fabric.Object.NUM_FRACTION_DIGITS,c="path-group"===this.type?"":"translate("+h(c.x,a)+" "+h(c.y,a)+")",d=0!==d?" rotate("+h(d,a)+")":"",h=1===this.scaleX&&1===this.scaleY&&1===g[0]&&1===g[3]?"":" scale("+h(this.scaleX*g[0],a)+" "+h(this.scaleY*g[3],a)+")",a="path-group"===this.type?this.width*g[0]:0,g="path-group"===this.type?this.height*g[3]:0;return[c,d,h,this.flipX?" matrix(-1 0 0 1 "+a+" 0) ":"",
this.flipY?" matrix(1 0 0 -1 0 "+g+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var h=[];this.fill&&this.fill.toLive&&h.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&h.push(this.stroke.toSVG(this,!1));this.shadow&&h.push(this.shadow.toSVG(this));return h}});
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(h){return this.get(h)!==this.originalState[h]},this)},saveState:function(h){this.stateProperties.forEach(function(d){this.originalState[d]=this.get(d)},this);h&&h.stateProperties&&h.stateProperties.forEach(function(d){this.originalState[d]=this.get(d)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(h){if(!this.hasControls||!this.active)return!1;var d=h.x;h=h.y;var g,c;for(c in this.oCoords)if(this.isControlVisible(c)&&("mtr"!==c||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==c&&"mr"!==c&&"mb"!==c&&"ml"!==c)&&(g=this._getImageLines(this.oCoords[c].corner),g=this._findCrossPoints({x:d,y:h},g),0!==g&&1===g%2))return this.__corner=c;return!1},_setCornerCoords:function(){},
_getNonTransformedDimensions:function(){var h=this.strokeWidth,d=this.width,g=this.height,c=!0,a=!0;"line"===this.type&&"butt"===this.strokeLineCap&&(a=d,c=g);a&&(g+=0>g?-h:h);c&&(d+=0>d?-h:h);return{x:d,y:g}},_getTransformedDimensions:function(h){h||(h=this._getNonTransformedDimensions());var d=this._calcDimensionsTransformMatrix();return fabric.util.transformPoint(h,d,!0)},_calculateCurrentDimensions:function(){var h=this.getViewportTransform(),d=this._getTransformedDimensions(),g=d.x,d=d.y,g=g+
2*this.padding,d=d+2*this.padding;return fabric.util.transformPoint(new fabric.Point(g,d),h,!0)},drawBorders:function(h){if(!this.hasBorders)return this;h.save();h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;h.strokeStyle=this.borderColor;h.lineWidth=1/this.borderScaleFactor;var d=this._calculateCurrentDimensions(),g=d.x,d=d.y;this.group&&(g*=this.group.scaleX,d*=this.group.scaleY);h.strokeRect(~~-(g/2)-.5,~~-(d/2)-.5,~~g+1,~~d+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&
!this.get("lockRotation")&&this.hasControls&&(g=-d/2,h.beginPath(),h.moveTo(0,g),h.lineTo(0,g-this.rotatingPointOffset),h.closePath(),h.stroke());h.restore();return this},drawControls:function(h){if(!this.hasControls)return this;var d=this._calculateCurrentDimensions(),g=d.x,d=d.y,c=this.cornerSize/2,a=-(g/2)-c,c=-(d/2)-c,b=this.transparentCorners?"strokeRect":"fillRect";h.save();h.lineWidth=1;h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;h.strokeStyle=h.fillStyle=this.cornerColor;this._drawControl("tl",
h,b,a,c);this._drawControl("tr",h,b,a+g,c);this._drawControl("bl",h,b,a,c+d);this._drawControl("br",h,b,a+g,c+d);this.get("lockUniScaling")||(this._drawControl("mt",h,b,a+g/2,c),this._drawControl("mb",h,b,a+g/2,c+d),this._drawControl("mr",h,b,a+g,c+d/2),this._drawControl("ml",h,b,a,c+d/2));this.hasRotatingPoint&&this._drawControl("mtr",h,b,a+g/2,c-this.rotatingPointOffset);h.restore();return this},_drawControl:function(h,d,g,c,a){this.isControlVisible(h)&&(h=this.cornerSize,"undefined"!==typeof G_vmlCanvasManager||
this.transparentCorners||d.clearRect(c,a,h,h),d[g](c,a,h,h))},isControlVisible:function(h){return this._getControlsVisibility()[h]},setControlVisible:function(h,d){this._getControlsVisibility()[h]=d;return this},setControlsVisibility:function(h){h||(h={});for(var d in h)this.setControlVisible(d,h[d]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();
(function(h){function d(a,b){var c=a.origin,d=a.axis1,g=a.axis2,h=a.dimension,E=b.nearest,A=b.center,C=b.farthest;return function(){switch(this.get(c)){case E:return Math.min(this.get(d),this.get(g));case A:return Math.min(this.get(d),this.get(g))+.5*this.get(h);case C:return Math.max(this.get(d),this.get(g))}}}var g=h.fabric||(h.fabric={}),c=g.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},b=g.StaticCanvas.supports("setLineDash");g.Line?g.warn("fabric.Line is already defined"):(g.Line=g.util.createClass(g.Object,
{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.constructor.superclass.prototype.initialize.apply(this,[b]);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(b,c){this.constructor.superclass.prototype._set.apply(this,
[b,c]);"undefined"!==typeof a[b]&&this._setWidthHeight();return this},_getLeftToOriginX:d({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:d({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,c){a.beginPath();if(c){var d=this.getCenterPoint();a.translate(d.x-this.strokeWidth/2,d.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&
b)d=this.calcLinePoints(),a.moveTo(d.x1,d.y1),a.lineTo(d.x2,d.y2);a.lineWidth=this.strokeWidth;d=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=d},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath();g.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray);a.closePath()},toObject:function(a){return c(this.constructor.superclass.prototype.toObject.apply(this,[a]),this.calcLinePoints())},calcLinePoints:function(){var a=
this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1;return{x1:a*this.width*.5,x2:a*this.width*-.5,y1:b*this.height*.5,y2:b*this.height*-.5}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||(c=this.calcLinePoints());b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):
b.join("")},complexity:function(){return 1}}),g.Line.fromObject=function(a){return new g.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=Math.PI,c=d.util.object.extend;d.Circle?d.warn("fabric.Circle is already defined."):(d.Circle=d.util.createClass(d.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*g,initialize:function(a){a=a||{};this.constructor.superclass.prototype.initialize.apply(this,[a]);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){this.constructor.superclass.prototype._set.apply(this,
[a,b]);"radius"===a&&this.setRadius(b);return this},toObject:function(a){return c(this.constructor.superclass.prototype.toObject.apply(this,[a]),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,e=0,d=(this.endAngle-this.startAngle)%(2*g);if(0===d)this.group&&"path-group"===this.group.type&&(c=this.left+this.radius,e=this.top+this.radius),b.push("<circle ",'cx="'+c+'" cy="'+e+'" ','r="',this.radius,'" style="',this.getSvgStyles(),
'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var c=Math.cos(this.startAngle)*this.radius,e=Math.sin(this.startAngle)*this.radius,h=Math.cos(this.endAngle)*this.radius,t=Math.sin(this.endAngle)*this.radius;b.push('<path d="M '+c+" "+e," A "+this.radius+" "+this.radius," 0 ",+(d>g?1:0)+" 1"," "+h+" "+t,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(b.join("")):b.join("")},_render:function(a,
b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;return this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),d.Circle.fromObject=function(a){return new d.Circle(a)})})("undefined"!==typeof exports?
exports:this);
(function(h){var d=h.fabric||(h.fabric={});d.Triangle?d.warn("fabric.Triangle is already defined"):(d.Triangle=d.util.createClass(d.Object,{type:"triangle",initialize:function(d){d=d||{};this.constructor.superclass.prototype.initialize.apply(this,[d]);this.set("width",d.width||100).set("height",d.height||100)},_render:function(d){var c=this.width/2,a=this.height/2;d.beginPath();d.moveTo(-c,a);d.lineTo(0,-a);d.lineTo(c,a);d.closePath();this._renderFill(d);this._renderStroke(d)},_renderDashedStroke:function(g){var c=this.width/
2,a=this.height/2;g.beginPath();d.util.drawDashedLine(g,-c,a,0,-a,this.strokeDashArray);d.util.drawDashedLine(g,0,-a,c,a,this.strokeDashArray);d.util.drawDashedLine(g,c,a,-c,a,this.strokeDashArray);g.closePath()},toSVG:function(d){var c=this._createBaseSVGMarkup(),a=this.width/2,b=this.height/2,a=[-a+" "+b,"0 "+-b,a+" "+b].join();c.push("<polygon ",'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return d?d(c.join("")):c.join("")},complexity:function(){return 1}}),
d.Triangle.fromObject=function(g){return new d.Triangle(g)})})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=2*Math.PI,c=d.util.object.extend;d.Ellipse?d.warn("fabric.Ellipse is already defined."):(d.Ellipse=d.util.createClass(d.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.constructor.superclass.prototype.initialize.apply(this,[a]);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){this.constructor.superclass.prototype._set.apply(this,[a,b]);switch(a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",
2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return c(this.constructor.superclass.prototype.toObject.apply(this,[a]),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,e=0;this.group&&"path-group"===this.group.type&&(c=this.left+this.rx,e=this.top+this.ry);b.push("<ellipse ",'cx="',c,'" cy="',e,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',
this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,g,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),d.Ellipse.fromObject=function(a){return new d.Ellipse(a)})})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Rect?d.warn("fabric.Rect is already defined"):(h=d.Object.prototype.stateProperties.concat(),h.push("rx","ry","x","y"),d.Rect=d.util.createClass(d.Object,{stateProperties:h,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(c){c=c||{};this.constructor.superclass.prototype.initialize.apply(this,[c]);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(c,
a){if(1===this.width&&1===this.height)c.fillRect(0,0,1,1);else{var b=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,g=this.height,h=a?this.left:-this.width/2,t=a?this.top:-this.height/2,y=0!==b||0!==d;c.beginPath();c.moveTo(h+b,t);c.lineTo(h+e-b,t);y&&c.bezierCurveTo(h+e-.4477152502*b,t,h+e,t+.4477152502*d,h+e,t+d);c.lineTo(h+e,t+g-d);y&&c.bezierCurveTo(h+e,t+g-.4477152502*d,h+e-.4477152502*b,t+g,h+e-b,t+g);c.lineTo(h+b,t+g);y&&c.bezierCurveTo(h+
.4477152502*b,t+g,h,t+g-.4477152502*d,h,t+g-d);c.lineTo(h,t+d);y&&c.bezierCurveTo(h,t+.4477152502*d,h+.4477152502*b,t,h+b,t);c.closePath();this._renderFill(c);this._renderStroke(c)}},_renderDashedStroke:function(c){var a=-this.width/2,b=-this.height/2,f=this.width,e=this.height;c.beginPath();d.util.drawDashedLine(c,a,b,a+f,b,this.strokeDashArray);d.util.drawDashedLine(c,a+f,b,a+f,b+e,this.strokeDashArray);d.util.drawDashedLine(c,a+f,b+e,a,b+e,this.strokeDashArray);d.util.drawDashedLine(c,a,b+e,a,
b,this.strokeDashArray);c.closePath()},toObject:function(c){c=g(this.constructor.superclass.prototype.toObject.apply(this,[c]),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(c);return c},toSVG:function(c){var a=this._createBaseSVGMarkup(),b=this.left,d=this.top;this.group&&"path-group"===this.group.type||(b=-this.width/2,d=-this.height/2);a.push("<rect ",'x="',b,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',
this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return c?c(a.join("")):a.join("")},complexity:function(){return 1}}),d.Rect.fromObject=function(c){return new d.Rect(c)})})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={});d.Polyline?d.warn("fabric.Polyline is already defined"):(d.Polyline=d.util.createClass(d.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(g,c){return d.Polygon.prototype.initialize.call(this,g,c)},_calcDimensions:function(){return d.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return d.Polygon.prototype._applyPointOffset.call(this)},toObject:function(g){return d.Polygon.prototype.toObject.call(this,g)},toSVG:function(g){return d.Polygon.prototype.toSVG.call(this,
g)},_render:function(g){d.Polygon.prototype.commonRender.call(this,g)&&(this._renderFill(g),this._renderStroke(g))},_renderDashedStroke:function(g){var c,a;g.beginPath();for(var b=0,f=this.points.length;b<f;b++)c=this.points[b],a=this.points[b+1]||c,d.util.drawDashedLine(g,c.x,c.y,a.x,a.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),d.Polyline.fromObject=function(g){return new d.Polyline(g.points,g,!0)})})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend,c=d.util.array.min,a=d.util.array.max,b=d.util.toFixed;d.Polygon?d.warn("fabric.Polygon is already defined"):(d.Polygon=d.util.createClass(d.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a||[];this.constructor.superclass.prototype.initialize.apply(this,[b]);this._calcDimensions();"top"in b||(this.top=this.minY);"left"in b||(this.left=this.minX)},_calcDimensions:function(){var b=this.points,
d=c(b,"x"),g=c(b,"y"),h=a(b,"x"),b=a(b,"y");this.width=h-d||0;this.height=b-g||0;this.minX=d||0;this.minY=g||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return g(this.constructor.superclass.prototype.toObject.apply(this,[a]),{points:this.points.concat()})},toSVG:function(a){for(var c=[],d=this._createBaseSVGMarkup(),g=0,h=this.points.length;g<h;g++)c.push(b(this.points[g].x,2),",",b(this.points[g].y,
2)," ");d.push("<",this.type," ",'points="',c.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(d.join("")):d.join("")},_render:function(a){this.commonRender(a)&&(this._renderFill(a),this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},commonRender:function(a){var b,c=this.points.length;if(!c||isNaN(this.points[c-1].y))return!1;a.beginPath();this._applyPointOffset&&(this.group&&"path-group"===
this.group.type||this._applyPointOffset(),this._applyPointOffset=null);a.moveTo(this.points[0].x,this.points[0].y);for(var d=0;d<c;d++)b=this.points[d],a.lineTo(b.x,b.y);return!0},_renderDashedStroke:function(a){d.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),d.Polygon.fromObject=function(a){return new d.Polygon(a.points,a,!0)})})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.array.min,c=d.util.array.max,a=d.util.object.extend,b=Object.prototype.toString,f=d.util.drawArc,e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},r={m:"l",M:"L"};d.Path?d.warn("fabric.Path is already defined"):(d.Path=d.util.createClass(d.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,c){c=c||{};this.setOptions(c);a||(a=[]);var d="[object Array]"===b.call(a);if(this.path=d?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))d||(this.path=
this._parsePath()),this._setPositionDimensions(c),c.sourcePath&&this.setSourcePath(c.sourcePath)},_setPositionDimensions:function(a){var b=this._parseDimensions();this.minX=b.left;this.minY=b.top;this.width=b.width;this.height=b.height;"undefined"===typeof a.left&&(this.left=b.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0));"undefined"===typeof a.top&&(this.top=b.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0));this.pathOffset=this.pathOffset||
{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var b,c=null,d=0,e=0,g=0,h=0,r=0,k=0,q,u,l=-this.pathOffset.x,m=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(m=l=0);a.beginPath();for(var x=0,w=this.path.length;x<w;++x){b=this.path[x];switch(b[0]){case "l":g+=b[1];h+=b[2];a.lineTo(g+l,h+m);break;case "L":g=b[1];h=b[2];a.lineTo(g+l,h+m);break;case "h":g+=b[1];a.lineTo(g+l,h+m);break;case "H":g=b[1];a.lineTo(g+l,h+m);break;case "v":h+=b[1];a.lineTo(g+l,h+m);
break;case "V":h=b[1];a.lineTo(g+l,h+m);break;case "m":g+=b[1];h+=b[2];d=g;e=h;a.moveTo(g+l,h+m);break;case "M":g=b[1];h=b[2];d=g;e=h;a.moveTo(g+l,h+m);break;case "c":q=g+b[5];u=h+b[6];r=g+b[3];k=h+b[4];a.bezierCurveTo(g+b[1]+l,h+b[2]+m,r+l,k+m,q+l,u+m);g=q;h=u;break;case "C":g=b[5];h=b[6];r=b[3];k=b[4];a.bezierCurveTo(b[1]+l,b[2]+m,r+l,k+m,g+l,h+m);break;case "s":q=g+b[3];u=h+b[4];null===c[0].match(/[CcSs]/)?(r=g,k=h):(r=2*g-r,k=2*h-k);a.bezierCurveTo(r+l,k+m,g+b[1]+l,h+b[2]+m,q+l,u+m);r=g+b[1];
k=h+b[2];g=q;h=u;break;case "S":q=b[3];u=b[4];null===c[0].match(/[CcSs]/)?(r=g,k=h):(r=2*g-r,k=2*h-k);a.bezierCurveTo(r+l,k+m,b[1]+l,b[2]+m,q+l,u+m);g=q;h=u;r=b[1];k=b[2];break;case "q":q=g+b[3];u=h+b[4];r=g+b[1];k=h+b[2];a.quadraticCurveTo(r+l,k+m,q+l,u+m);g=q;h=u;break;case "Q":q=b[3];u=b[4];a.quadraticCurveTo(b[1]+l,b[2]+m,q+l,u+m);g=q;h=u;r=b[1];k=b[2];break;case "t":q=g+b[1];u=h+b[2];null===c[0].match(/[QqTt]/)?(r=g,k=h):(r=2*g-r,k=2*h-k);a.quadraticCurveTo(r+l,k+m,q+l,u+m);g=q;h=u;break;case "T":q=
b[1];u=b[2];null===c[0].match(/[QqTt]/)?(r=g,k=h):(r=2*g-r,k=2*h-k);a.quadraticCurveTo(r+l,k+m,q+l,u+m);g=q;h=u;break;case "a":f(a,g+l,h+m,[b[1],b[2],b[3],b[4],b[5],b[6]+g+l,b[7]+h+m]);g+=b[6];h+=b[7];break;case "A":f(a,g+l,h+m,[b[1],b[2],b[3],b[4],b[5],b[6]+l,b[7]+m]);g=b[6];h=b[7];break;case "z":case "Z":g=d,h=e,a.closePath()}c=b}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(b){b=
a(this.constructor.superclass.prototype.toObject.apply(this,[b]),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(b.sourcePath=this.sourcePath);this.transformMatrix&&(b.transformMatrix=this.transformMatrix);return b},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d="",e=0,f=this.path.length;e<f;e++)b.push(this.path[e].join(" "));
b=b.join(" ");this.group&&"path-group"===this.group.type||(d=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");c.push("<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,d,f=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,g,h=0,n=this.path.length;h<n;h++){c=
this.path[h];g=c.slice(1).trim();for(b.length=0;d=f.exec(g);)b.push(d[0]);c=[c.charAt(0)];g=0;for(var k=b.length;g<k;g++)d=parseFloat(b[g]),isNaN(d)||c.push(d);d=c[0];g=e[d.toLowerCase()];k=r[d]||d;if(c.length-1>g)for(var q=1,u=c.length;q<u;q+=g)a.push([d].concat(c.slice(q,q+g))),d=k;else a.push(c)}return a},_parseDimensions:function(){for(var a=[],b=[],e,f=null,h=0,r=0,p=0,n=0,k=0,q=0,u,l,m,x=0,w=this.path.length;x<w;++x){e=this.path[x];switch(e[0]){case "l":p+=e[1];n+=e[2];m=[];break;case "L":p=
e[1];n=e[2];m=[];break;case "h":p+=e[1];m=[];break;case "H":p=e[1];m=[];break;case "v":n+=e[1];m=[];break;case "V":n=e[1];m=[];break;case "m":p+=e[1];n+=e[2];h=p;r=n;m=[];break;case "M":p=e[1];n=e[2];h=p;r=n;m=[];break;case "c":u=p+e[5];l=n+e[6];k=p+e[3];q=n+e[4];m=d.util.getBoundsOfCurve(p,n,p+e[1],n+e[2],k,q,u,l);p=u;n=l;break;case "C":p=e[5];n=e[6];k=e[3];q=e[4];m=d.util.getBoundsOfCurve(p,n,e[1],e[2],k,q,p,n);break;case "s":u=p+e[3];l=n+e[4];null===f[0].match(/[CcSs]/)?(k=p,q=n):(k=2*p-k,q=2*
n-q);m=d.util.getBoundsOfCurve(p,n,k,q,p+e[1],n+e[2],u,l);k=p+e[1];q=n+e[2];p=u;n=l;break;case "S":u=e[3];l=e[4];null===f[0].match(/[CcSs]/)?(k=p,q=n):(k=2*p-k,q=2*n-q);m=d.util.getBoundsOfCurve(p,n,k,q,e[1],e[2],u,l);p=u;n=l;k=e[1];q=e[2];break;case "q":u=p+e[3];l=n+e[4];k=p+e[1];q=n+e[2];m=d.util.getBoundsOfCurve(p,n,k,q,k,q,u,l);p=u;n=l;break;case "Q":k=e[1];q=e[2];m=d.util.getBoundsOfCurve(p,n,k,q,k,q,e[3],e[4]);p=e[3];n=e[4];break;case "t":u=p+e[1];l=n+e[2];null===f[0].match(/[QqTt]/)?(k=p,q=
n):(k=2*p-k,q=2*n-q);m=d.util.getBoundsOfCurve(p,n,k,q,k,q,u,l);p=u;n=l;break;case "T":u=e[1];l=e[2];null===f[0].match(/[QqTt]/)?(k=p,q=n):(k=2*p-k,q=2*n-q);m=d.util.getBoundsOfCurve(p,n,k,q,k,q,u,l);p=u;n=l;break;case "a":m=d.util.getBoundsOfArc(p,n,e[1],e[2],e[3],e[4],e[5],e[6]+p,e[7]+n);p+=e[6];n+=e[7];break;case "A":m=d.util.getBoundsOfArc(p,n,e[1],e[2],e[3],e[4],e[5],e[6],e[7]);p=e[6];n=e[7];break;case "z":case "Z":p=h,n=r}f=e;m.forEach(function(c){a.push(c.x);b.push(c.y)});a.push(p);b.push(n)}e=
g(a)||0;f=g(b)||0;h=c(a)||0;r=c(b)||0;return{left:e,top:f,width:h-e,height:r-f}}}),d.Path.fromObject=function(a,b){"string"===typeof a.path?d.loadSVGFromURL(a.path,function(c){c=c[0];var e=a.path;delete a.path;d.util.object.extend(c,a);c.setSourcePath(e);b(c)}):b(new d.Path(a.path,a))},d.Path.async=!0)})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend,c=d.util.array.invoke,a=d.Object.prototype.toObject;d.PathGroup?d.warn("fabric.PathGroup is already defined"):(d.PathGroup=d.util.createClass(d.Path,{type:"path-group",fill:"",initialize:function(a,c){c=c||{};this.paths=a||[];for(var e=this.paths.length;e--;)this.paths[e].group=this;c.toBeParsed&&(this.parseDimensionsFromPaths(c),delete c.toBeParsed);this.setOptions(c);this.setCoords();c.sourcePath&&this.setSourcePath(c.sourcePath)},
parseDimensionsFromPaths:function(a){for(var c,e,g=[],h=[],t,y=this.paths.length;y--;){c=this.paths[y];e=c.height+c.strokeWidth;t=c.width+c.strokeWidth;c=[{x:c.left,y:c.top},{x:c.left+t,y:c.top},{x:c.left,y:c.top+e},{x:c.left+t,y:c.top+e}];t=this.paths[y].transformMatrix;for(var E=0;E<c.length;E++)e=c[E],t&&(e=d.util.transformPoint(e,t,!1)),g.push(e.x),h.push(e.y)}a.width=Math.max.apply(null,g);a.height=Math.max.apply(null,h)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,
this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&d.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var c=0,e=this.paths.length;c<e;++c)this.paths[c].render(a,!0);this.clipTo&&a.restore();a.restore()}},_set:function(a,c){if("fill"===a&&c&&this.isSameColor())for(var e=this.paths.length;e--;)this.paths[e]._set(a,c);return this.constructor.superclass.prototype._set.apply(this,[a,c])},toObject:function(b){b=g(a.call(this,b),{paths:c(this.getObjects(),"toObject",
b)});this.sourcePath&&(b.sourcePath=this.sourcePath);return b},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){for(var c=this.getObjects(),e=this.getPointByOrigin("left","top"),e="translate("+e.x+" "+e.y+")",e=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),e,this.getSvgTransform(),'" ',">\n"],d=0,g=c.length;d<g;d++)e.push(c[d].toSVG(a));e.push("</g>\n");return a?a(e.join("")):e.join("")},toString:function(){return"#<fabric.PathGroup ("+
this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(c){return(c.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,c){return a+(c&&c.complexity?c.complexity():0)},0)},getObjects:function(){return this.paths}}),d.PathGroup.fromObject=function(a,c){"string"===typeof a.paths?d.loadSVGFromURL(a.paths,function(e){var g=a.paths;
delete a.paths;e=d.util.groupSVGElements(e,a,g);c(e)}):d.util.enlivenObjects(a.paths,function(e){delete a.paths;c(new d.PathGroup(e,a))})},d.PathGroup.async=!0)})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend,c=d.util.array.min,a=d.util.array.max,b=d.util.array.invoke;if(!d.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};d.Group=d.util.createClass(d.Object,d.Collection,{type:"group",strokeWidth:0,initialize:function(a,b,c){b=b||{};this._objects=[];c&&this.constructor.superclass.prototype.initialize.apply(this,[b]);this._objects=a||[];for(a=this._objects.length;a--;)this._objects[a].group=
this;this.originalState={};b.originX&&(this.originX=b.originX);b.originY&&(this.originY=b.originY);c?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.constructor.superclass.prototype.initialize.apply(this,[b]));this.setCoords();this.saveCoords()},_updateObjectsCoords:function(a){for(var b=this._objects.length;b--;)this._updateObjectCoords(this._objects[b],a)},_updateObjectCoords:function(a,b){a.__origHasControls=a.hasControls;a.hasControls=!1;if(!b){var c=a.getLeft(),
d=a.getTop(),f=this.getCenterPoint();a.set({originalLeft:c,originalTop:d,left:c-f.x,top:d-f.y});a.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas));this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);
this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this;a._set("canvas",this.canvas)},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){var c=this._objects.length;if(this.delegatedProperties[a]||
"canvas"===a)for(;c--;)this._objects[c].set(a,b);else for(;c--;)this._objects[c].setOnGroup(a,b);this.constructor.superclass.prototype._set.apply(this,[a,b])},toObject:function(a){return g(this.constructor.superclass.prototype.toObject.apply(this,[a]),{objects:b(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this.clipTo&&d.util.clipContext(this,a);for(var b=0,c=this._objects.length;b<c;b++)this._renderObject(this._objects[b],
a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,b){},_renderObject:function(a,b){if(a.visible){var c=a.hasRotatingPoint;a.hasRotatingPoint=!1;a.render(b);a.hasRotatingPoint=c}},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){this._moveFlippedObject(a);this._setObjectPosition(a);return a},_moveFlippedObject:function(a){var b=a.get("originX"),c=a.get("originY"),d=a.getCenterPoint();a.set({originX:"center",
originY:"center",left:d.x,top:d.y});this._toggleFlipping(a);d=a.getPointByOrigin(b,c);a.set({originX:b,originY:c,left:d.x,top:d.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();
delete a.group;return this},_setObjectPosition:function(a){var b=this.getCenterPoint(),c=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b.x+c.left,top:b.y+c.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*
this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_calcBounds:function(a){for(var b=[],c=[],d,f,g=["tr","br","bl","tl"],h=0,C=this._objects.length,
p,n=g.length;h<C;++h)for(d=this._objects[h],d.setCoords(),p=0;p<n;p++)f=g[p],b.push(d.oCoords[f].x),c.push(d.oCoords[f].y);this.set(this._getBounds(b,c,a))},_getBounds:function(b,f,g){var h=d.util.invertTransform(this.getViewportTransform()),y=d.util.transformPoint(new d.Point(c(b),c(f)),h);b=d.util.transformPoint(new d.Point(a(b),a(f)),h);b={width:b.x-y.x||0,height:b.y-y.y||0};g||(b.left=y.x||0,b.top=y.y||0,"center"===this.originX&&(b.left+=b.width/2),"right"===this.originX&&(b.left+=b.width),"center"===
this.originY&&(b.top+=b.height/2),"bottom"===this.originY&&(b.top+=b.height));return b},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,d=this._objects.length;c<d;c++)b.push(this._objects[c].toSVG(a));b.push("</g>\n");return a?a(b.join("")):b.join("")},get:function(a){if(a in f){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):
this[a]}});d.Group.fromObject=function(a,b){d.util.enlivenObjects(a.objects,function(c){delete a.objects;b&&b(new d.Group(c,a,!0))})};d.Group.async=!0}})("undefined"!==typeof exports?exports:this);
(function(h){var d=fabric.util.object.extend;h.fabric||(h.fabric={});h.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(d,c){c||(c={});this.filters=[];this.resizeFilters=[];this.constructor.superclass.prototype.initialize.apply(this,[c]);this._initElement(d,c)},getElement:function(){return this._element},setElement:function(d,
c,a){this._originalElement=this._element=d;this._initConfig(a);0!==this.filters.length?this.applyFilters(c):c&&c();return this},setCrossOrigin:function(d){this.crossOrigin=d;this._element.crossOrigin=d;return this},getOriginalSize:function(){var d=this.getElement();return{width:d.width,height:d.height}},_stroke:function(d){d.save();this._setStrokeStyles(d);d.beginPath();d.strokeRect(-this.width/2,-this.height/2,this.width,this.height);d.closePath();d.restore()},_renderDashedStroke:function(d){var c=
-this.width/2,a=-this.height/2,b=this.width,f=this.height;d.save();this._setStrokeStyles(d);d.beginPath();fabric.util.drawDashedLine(d,c,a,c+b,a,this.strokeDashArray);fabric.util.drawDashedLine(d,c+b,a,c+b,a+f,this.strokeDashArray);fabric.util.drawDashedLine(d,c+b,a+f,c,a+f,this.strokeDashArray);fabric.util.drawDashedLine(d,c,a+f,c,a,this.strokeDashArray);d.closePath();d.restore()},toObject:function(g){var c=[];this.filters.forEach(function(a){a&&c.push(a.toObject())});g=d(this.constructor.superclass.prototype.toObject.apply(this,
[g]),{src:this._originalElement.src||this._originalElement._src,filters:c,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});0<this.resizeFilters.length&&(g.resizeFilters=this.resizeFilters.map(function(a){return a&&a.toObject()}));this.includeDefaultValues||this._removeDefaultValues(g);return g},toSVG:function(d){var c=[],a=-this.width/2,b=-this.height/2,f="none";this.group&&"path-group"===this.group.type&&(a=this.left,b=this.top);"none"!==this.alignX&&
"none"!==this.alignY&&(f="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);c.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',a,'" y="',b,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',f,'"',"></image>\n");if(this.stroke||this.strokeDashArray)f=this.fill,this.fill=null,c.push("<rect ",'x="',a,'" y="',b,'" width="',this.width,'" height="',this.height,'" style="',
this.getSvgStyles(),'"/>\n'),this.fill=f;c.push("</g>\n");return d?d(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(d,c,a){fabric.util.loadImage(d,function(b){return this.setElement(b,c,a)},this,a&&a.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(d,c){this.constructor.fromObject(this.toObject(c),d)},applyFilters:function(d,c,a,b){c=c||this.filters;if(a=a||
this._originalElement){var f=a,e=fabric.util.createCanvasElement(),h=fabric.util.createImage(),v=this;e.width=f.width;e.height=f.height;e.getContext("2d").drawImage(f,0,0,f.width,f.height);if(0===c.length)return this._element=a,d&&d(),e;c.forEach(function(a){a&&a.applyTo(e,a.scaleX||v.scaleX,a.scaleY||v.scaleY);!b&&a&&"Resize"===a.type&&(v.width*=a.scaleX,v.height*=a.scaleY)});h.width=e.width;h.height=e.height;fabric.isLikelyNode?(h.src=e.toBuffer(void 0,fabric.Image.pngCompression),v._element=h,
!b&&(v._filteredEl=h),d&&d()):(h.onload=function(){v._element=h;!b&&(v._filteredEl=h);d&&d();h.onload=e=f=null},h.src=e.toDataURL("image/png"));return e}},_render:function(d,c){var a,b,f=this._findMargins(),e;a=c?this.left:-this.width/2;b=c?this.top:-this.height/2;"slice"===this.meetOrSlice&&(d.beginPath(),d.rect(a,b,this.width,this.height),d.clip());!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,e=this.applyFilters(null,
this.resizeFilters,this._filteredEl||this._originalElement,!0)):e=this._element;e&&d.drawImage(e,a+f.marginX,b+f.marginY,f.width,f.height);this._renderStroke(d)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var d=this.width,c=this.height,a=0,b=0;if("none"!==this.alignX||"none"!==this.alignY)d=[this.width/this._element.width,this.height/this._element.height],c="meet"===this.meetOrSlice?Math.min.apply(null,d):Math.max.apply(null,
d),d=this._element.width*c,c*=this._element.height,"Mid"===this.alignX&&(a=(this.width-d)/2),"Max"===this.alignX&&(a=this.width-d),"Mid"===this.alignY&&(b=(this.height-c)/2),"Max"===this.alignY&&(b=this.height-c);return{width:d,height:c,marginX:a,marginY:b}},_resetWidthHeight:function(){var d=this.getElement();this.set("width",d.width);this.set("height",d.height)},_initElement:function(d,c){this.setElement(fabric.util.getById(d),null,c);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},
_initConfig:function(d){d||(d={});this.setOptions(d);this._setWidthHeight(d);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(d,c){d&&d.length?fabric.util.enlivenObjects(d,function(a){c&&c(a)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(d){this.width="width"in d?d.width:this.getElement()?this.getElement().width||0:0;this.height="height"in d?d.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS=
"canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(d,c){fabric.util.loadImage(d.src,function(a){fabric.Image.prototype._initFilters.call(d,d.filters,function(b){d.filters=b||[];fabric.Image.prototype._initFilters.call(d,d.resizeFilters,function(b){d.resizeFilters=b||[];b=new fabric.Image(a,d);c&&c(b)})})},null,d.crossOrigin)},fabric.Image.fromURL=function(d,c,a){fabric.util.loadImage(d,function(b){c&&c(new fabric.Image(b,a))},null,a&&a.crossOrigin)},
fabric.Image.async=!0,fabric.Image.pngCompression=1)})("undefined"!==typeof exports?exports:this);fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(h){h&&this.setOptions(h)},setOptions:function(h){for(var d in h)this[d]=h[d]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Image.filters.Brightness=d.util.createClass(d.Image.filters.BaseFilter,{type:"Brightness",initialize:function(c){c=c||{};this.brightness=c.brightness||0},applyTo:function(c){var a=c.getContext("2d");c=a.getImageData(0,0,c.width,c.height);for(var b=c.data,d=this.brightness,e=0,g=b.length;e<g;e+=4)b[e]+=d,b[e+1]+=d,b[e+2]+=d;a.putImageData(c,0,0)},toObject:function(){return g(this.constructor.superclass.prototype.toObject.apply(this),
{brightness:this.brightness})}});d.Image.filters.Brightness.fromObject=function(c){return new d.Image.filters.Brightness(c)}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Image.filters.Convolute=d.util.createClass(d.Image.filters.BaseFilter,{type:"Convolute",initialize:function(c){c=c||{};this.opaque=c.opaque;this.matrix=c.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=d.util.createCanvasElement().getContext("2d")},_createImageData:function(c,a){return this.tmpCtx.createImageData(c,a)},applyTo:function(c){var a=this.matrix,b=c.getContext("2d"),d=b.getImageData(0,0,c.width,c.height);c=Math.round(Math.sqrt(a.length));
for(var e=Math.floor(c/2),g=d.data,h=d.width,d=d.height,t=this._createImageData(h,d),y=t.data,E=this.opaque?1:0,A=0;A<d;A++)for(var C=0;C<h;C++){for(var p=A,n=C,k=4*(A*h+C),q=0,u=0,l=0,m=0,x=0;x<c;x++)for(var w=0;w<c;w++){var z=p+x-e,D=n+w-e;0>z||z>d||0>D||D>h||(z=4*(z*h+D),D=a[x*c+w],q+=g[z]*D,u+=g[z+1]*D,l+=g[z+2]*D,m+=g[z+3]*D)}y[k]=q;y[k+1]=u;y[k+2]=l;y[k+3]=m+E*(255-m)}b.putImageData(t,0,0)},toObject:function(){return g(this.constructor.superclass.prototype.toObject.apply(this),{opaque:this.opaque,
matrix:this.matrix})}});d.Image.filters.Convolute.fromObject=function(c){return new d.Image.filters.Convolute(c)}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Image.filters.GradientTransparency=d.util.createClass(d.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(c){c=c||{};this.threshold=c.threshold||100},applyTo:function(c){var a=c.getContext("2d");c=a.getImageData(0,0,c.width,c.height);for(var b=c.data,d=this.threshold,e=b.length,g=0,h=b.length;g<h;g+=4)b[g+3]=d+255*(e-g)/e;a.putImageData(c,0,0)},toObject:function(){return g(this.constructor.superclass.prototype.toObject.apply(this),
{threshold:this.threshold})}});d.Image.filters.GradientTransparency.fromObject=function(c){return new d.Image.filters.GradientTransparency(c)}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={});d.Image.filters.Grayscale=d.util.createClass(d.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(d){var c=d.getContext("2d");d=c.getImageData(0,0,d.width,d.height);for(var a=d.data,b=d.width*d.height*4,f=0,e;f<b;)e=(a[f]+a[f+1]+a[f+2])/3,a[f]=e,a[f+1]=e,a[f+2]=e,f+=4;c.putImageData(d,0,0)}});d.Image.filters.Grayscale.fromObject=function(){return new d.Image.filters.Grayscale}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={});d.Image.filters.Invert=d.util.createClass(d.Image.filters.BaseFilter,{type:"Invert",applyTo:function(d){var c=d.getContext("2d");d=c.getImageData(0,0,d.width,d.height);var a=d.data,b=a.length,f;for(f=0;f<b;f+=4)a[f]=255-a[f],a[f+1]=255-a[f+1],a[f+2]=255-a[f+2];c.putImageData(d,0,0)}});d.Image.filters.Invert.fromObject=function(){return new d.Image.filters.Invert}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Image.filters.Mask=d.util.createClass(d.Image.filters.BaseFilter,{type:"Mask",initialize:function(c){c=c||{};this.mask=c.mask;this.channel=-1<[0,1,2,3].indexOf(c.channel)?c.channel:0},applyTo:function(c){if(this.mask){var a=c.getContext("2d");c=a.getImageData(0,0,c.width,c.height);var b=c.data,f=this.mask.getElement(),e=d.util.createCanvasElement(),g=this.channel,h=c.width*c.height*4;e.width=f.width;e.height=f.height;e.getContext("2d").drawImage(f,
0,0,f.width,f.height);e=e.getContext("2d").getImageData(0,0,f.width,f.height).data;for(f=0;f<h;f+=4)b[f+3]=e[f+g];a.putImageData(c,0,0)}},toObject:function(){return g(this.constructor.superclass.prototype.toObject.apply(this),{mask:this.mask.toObject(),channel:this.channel})}});d.Image.filters.Mask.fromObject=function(c,a){d.util.loadImage(c.mask.src,function(b){c.mask=new d.Image(b,c.mask);a&&a(new d.Image.filters.Mask(c))})};d.Image.filters.Mask.async=!0})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Image.filters.Noise=d.util.createClass(d.Image.filters.BaseFilter,{type:"Noise",initialize:function(c){c=c||{};this.noise=c.noise||0},applyTo:function(c){var a=c.getContext("2d");c=a.getImageData(0,0,c.width,c.height);for(var b=c.data,d=this.noise,e,g=0,h=b.length;g<h;g+=4)e=(.5-Math.random())*d,b[g]+=e,b[g+1]+=e,b[g+2]+=e;a.putImageData(c,0,0)},toObject:function(){return g(this.constructor.superclass.prototype.toObject.apply(this),
{noise:this.noise})}});d.Image.filters.Noise.fromObject=function(c){return new d.Image.filters.Noise(c)}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Image.filters.Pixelate=d.util.createClass(d.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(c){c=c||{};this.blocksize=c.blocksize||4},applyTo:function(c){var a=c.getContext("2d");c=a.getImageData(0,0,c.width,c.height);var b=c.data,d=c.height,e=c.width,g,h,t,y,E,A,C;for(h=0;h<d;h+=this.blocksize)for(t=0;t<e;t+=this.blocksize){g=4*h*e+4*t;y=b[g];E=b[g+1];A=b[g+2];C=b[g+3];for(var p=h,n=h+this.blocksize;p<n;p++)for(var k=
t,q=t+this.blocksize;k<q;k++)g=4*p*e+4*k,b[g]=y,b[g+1]=E,b[g+2]=A,b[g+3]=C}a.putImageData(c,0,0)},toObject:function(){return g(this.constructor.superclass.prototype.toObject.apply(this),{blocksize:this.blocksize})}});d.Image.filters.Pixelate.fromObject=function(c){return new d.Image.filters.Pixelate(c)}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Image.filters.RemoveWhite=d.util.createClass(d.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(c){c=c||{};this.threshold=c.threshold||30;this.distance=c.distance||20},applyTo:function(c){var a=c.getContext("2d");c=a.getImageData(0,0,c.width,c.height);for(var b=c.data,d=this.distance,e=255-this.threshold,g=Math.abs,h,t,y,E=0,A=b.length;E<A;E+=4)h=b[E],t=b[E+1],y=b[E+2],h>e&&t>e&&y>e&&g(h-t)<d&&g(h-y)<d&&g(t-y)<d&&
(b[E+3]=1);a.putImageData(c,0,0)},toObject:function(){return g(this.constructor.superclass.prototype.toObject.apply(this),{threshold:this.threshold,distance:this.distance})}});d.Image.filters.RemoveWhite.fromObject=function(c){return new d.Image.filters.RemoveWhite(c)}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={});d.Image.filters.Sepia=d.util.createClass(d.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(d){var c=d.getContext("2d");d=c.getImageData(0,0,d.width,d.height);var a=d.data,b=a.length,f,e;for(f=0;f<b;f+=4)e=.3*a[f]+.59*a[f+1]+.11*a[f+2],a[f]=e+100,a[f+1]=e+50,a[f+2]=e+255;c.putImageData(d,0,0)}});d.Image.filters.Sepia.fromObject=function(){return new d.Image.filters.Sepia}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={});d.Image.filters.Sepia2=d.util.createClass(d.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(d){var c=d.getContext("2d");d=c.getImageData(0,0,d.width,d.height);var a=d.data,b=a.length,f,e,h,v;for(f=0;f<b;f+=4)e=a[f],h=a[f+1],v=a[f+2],a[f]=(.393*e+.769*h+.189*v)/1.351,a[f+1]=(.349*e+.686*h+.168*v)/1.203,a[f+2]=(.272*e+.534*h+.131*v)/2.14;c.putImageData(d,0,0)}});d.Image.filters.Sepia2.fromObject=function(){return new d.Image.filters.Sepia2}})("undefined"!==
typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Image.filters.Tint=d.util.createClass(d.Image.filters.BaseFilter,{type:"Tint",initialize:function(c){c=c||{};this.color=c.color||"#000000";this.opacity="undefined"!==typeof c.opacity?c.opacity:(new d.Color(this.color)).getAlpha()},applyTo:function(c){var a=c.getContext("2d");c=a.getImageData(0,0,c.width,c.height);var b=c.data,f=b.length,e,g,h,t,y,E,A,C;e=(new d.Color(this.color)).getSource();g=e[0]*this.opacity;h=e[1]*this.opacity;
t=e[2]*this.opacity;C=1-this.opacity;for(e=0;e<f;e+=4)y=b[e],E=b[e+1],A=b[e+2],b[e]=g+y*C,b[e+1]=h+E*C,b[e+2]=t+A*C;a.putImageData(c,0,0)},toObject:function(){return g(this.constructor.superclass.prototype.toObject.apply(this),{color:this.color,opacity:this.opacity})}});d.Image.filters.Tint.fromObject=function(c){return new d.Image.filters.Tint(c)}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend;d.Image.filters.Multiply=d.util.createClass(d.Image.filters.BaseFilter,{type:"Multiply",initialize:function(c){c=c||{};this.color=c.color||"#000000"},applyTo:function(c){var a=c.getContext("2d");c=a.getImageData(0,0,c.width,c.height);var b=c.data,f=b.length,e,g;g=(new d.Color(this.color)).getSource();for(e=0;e<f;e+=4)b[e]*=g[0]/255,b[e+1]*=g[1]/255,b[e+2]*=g[2]/255;a.putImageData(c,0,0)},toObject:function(){return g(this.constructor.superclass.prototype.toObject.apply(this),
{color:this.color})}});d.Image.filters.Multiply.fromObject=function(c){return new d.Image.filters.Multiply(c)}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric;d.Image.filters.Blend=d.util.createClass({type:"Blend",initialize:function(d){d=d||{};this.color=d.color||"#000";this.image=d.image||!1;this.mode=d.mode||"multiply";this.alpha=d.alpha||1},applyTo:function(g){var c=g.getContext("2d");g=c.getImageData(0,0,g.width,g.height);var a=g.data,b,f,e,h,v,t,y,E=!1;this.image?(E=!0,y=d.util.createCanvasElement(),y.width=this.image.width,y.height=this.image.height,y=new d.StaticCanvas(y),y.add(this.image),y=y.getContext("2d").getImageData(0,
0,y.width,y.height).data):(y=(new d.Color(this.color)).getSource(),b=y[0]*this.alpha,f=y[1]*this.alpha,e=y[2]*this.alpha);for(var A=0,C=a.length;A<C;A+=4)switch(h=a[A],v=a[A+1],t=a[A+2],E&&(b=y[A]*this.alpha,f=y[A+1]*this.alpha,e=y[A+2]*this.alpha),this.mode){case "multiply":a[A]=h*b/255;a[A+1]=v*f/255;a[A+2]=t*e/255;break;case "screen":a[A]=1-(1-h)*(1-b);a[A+1]=1-(1-v)*(1-f);a[A+2]=1-(1-t)*(1-e);break;case "add":a[A]=Math.min(255,h+b);a[A+1]=Math.min(255,v+f);a[A+2]=Math.min(255,t+e);break;case "diff":case "difference":a[A]=
Math.abs(h-b);a[A+1]=Math.abs(v-f);a[A+2]=Math.abs(t-e);break;case "subtract":h-=b;v-=f;t-=e;a[A]=0>h?0:h;a[A+1]=0>v?0:v;a[A+2]=0>t?0:t;break;case "darken":a[A]=Math.min(h,b);a[A+1]=Math.min(v,f);a[A+2]=Math.min(t,e);break;case "lighten":a[A]=Math.max(h,b),a[A+1]=Math.max(v,f),a[A+2]=Math.max(t,e)}c.putImageData(g,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});d.Image.filters.Blend.fromObject=function(g){return new d.Image.filters.Blend(g)}})("undefined"!==
typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=Math.pow,c=Math.floor,a=Math.sqrt,b=Math.abs,f=Math.max,e=Math.round,r=Math.sin,v=Math.ceil;d.Image.filters.Resize=d.util.createClass(d.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){this.rcpScaleX=1/b;this.rcpScaleY=1/c;var d=a.width,f=a.height;b=e(d*b);c=e(f*c);var g;"sliceHack"===this.resizeType&&(g=this.sliceByTwo(a,d,f,b,c));"hermite"===this.resizeType&&(g=this.hermiteFastResize(a,
d,f,b,c));"bilinear"===this.resizeType&&(g=this.bilinearFiltering(a,d,f,b,c));"lanczos"===this.resizeType&&(g=this.lanczosResize(a,d,f,b,c));a.width=b;a.height=c;a.getContext("2d").putImageData(g,0,0)},sliceByTwo:function(a,b,e,g,h){var r=a.getContext("2d"),v,k=.5,q=.5,u=1,l=1,m=!1,x=!1,w=b,z=e,D=d.util.createCanvasElement(),B=D.getContext("2d");g=c(g);h=c(h);D.width=f(g,b);D.height=f(h,e);g>b&&(k=2,u=-1);h>e&&(q=2,l=-1);v=r.getImageData(0,0,b,e);a.width=f(g,b);a.height=f(h,e);for(r.putImageData(v,
0,0);!m||!x;)b=w,e=z,g*u<c(w*k*u)?w=c(w*k):(w=g,m=!0),h*l<c(z*q*l)?z=c(z*q):(z=h,x=!0),v=r.getImageData(0,0,b,e),B.putImageData(v,0,0),r.clearRect(0,0,w,z),r.drawImage(D,0,0,b,e,0,0,w,z);return r.getImageData(0,0,g,h)},lanczosResize:function(d,e,f,h,C){var p,n,k,q;function u(d){var r,t,v,l,K,P,Q,R,S,L;k=(d+.5)*D;p=c(k);for(r=0;r<C;r++){q=(r+.5)*B;n=c(q);S=R=Q=P=K=0;for(t=p-J;t<=p+J;t++)if(!(0>t||t>=e)){L=c(1E3*b(t-k));H[L]||(H[L]={});for(var M=n-T;M<=n+T;M++)0>M||M>=f||(v=c(1E3*b(M-q)),H[L][v]||(H[L][v]=
z(a(g(L*F,2)+g(v*G,2))/1E3)),v=H[L][v],0<v&&(l=4*(M*e+t),K+=v,P+=v*x[l],Q+=v*x[l+1],R+=v*x[l+2],S+=v*x[l+3]))}l=4*(r*h+d);w[l]=P/K;w[l+1]=Q/K;w[l+2]=R/K;w[l+3]=S/K}return++d<h?u(d):m}d=d.getContext("2d");var l=d.getImageData(0,0,e,f),m=d.getImageData(0,0,h,C),x=l.data,w=m.data,z=function(a){return function(c){if(c>a)return 0;c*=Math.PI;if(1E-16>b(c))return 1;var d=c/a;return r(c)*r(d)/c/d}}(this.lanczosLobes),D=this.rcpScaleX,B=this.rcpScaleY,F=2/this.rcpScaleX,G=2/this.rcpScaleY,J=v(D*this.lanczosLobes/
2),T=v(B*this.lanczosLobes/2),H={};n=p=q=k=void 0;return u(0)},bilinearFiltering:function(a,b,d,e,f){var g,h,r,v,u,l,m,x,w,z,D=0,B=this.rcpScaleX,F=this.rcpScaleY;m=a.getContext("2d");a=4*(b-1);d=m.getImageData(0,0,b,d).data;var G=m.getImageData(0,0,e,f),J=G.data;for(m=0;m<f;m++)for(x=0;x<e;x++)for(u=c(B*x),l=c(F*m),w=B*x-u,z=F*m-l,l=4*(l*b+u),u=0;4>u;u++)g=d[l+u],h=d[l+4+u],r=d[l+a+u],v=d[l+a+4+u],g=g*(1-w)*(1-z)+h*w*(1-z)+r*z*(1-w)+v*w*z,J[D++]=g;return G},hermiteFastResize:function(d,e,f,g,h){var r=
this.rcpScaleX,n=this.rcpScaleY,k=v(r/2),q=v(n/2);d=d.getContext("2d");f=d.getImageData(0,0,e,f).data;d=d.getImageData(0,0,g,h);for(var u=d.data,l=0;l<h;l++)for(var m=0;m<g;m++){for(var x=4*(m+l*g),w=0,z=0,D=0,B=0,F=0,G=0,J=0,T=(l+.5)*n,H=c(l*n);H<(l+1)*n;H++)for(var N=b(T-(H+.5))/q,U=(m+.5)*r,N=N*N,O=c(m*r);O<(m+1)*r;O++){var I=b(U-(O+.5))/k,w=a(N+I*I);1<w&&-1>w||(w=2*w*w*w-3*w*w+1,0<w&&(I=4*(O+H*e),J+=w*f[I+3],D+=w,255>f[I+3]&&(w=w*f[I+3]/250),B+=w*f[I],F+=w*f[I+1],G+=w*f[I+2],z+=w))}u[x]=B/z;u[x+
1]=F/z;u[x+2]=G/z;u[x+3]=J/D}return d},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});d.Image.filters.Resize.fromObject=function(a){return new d.Image.filters.Resize(a)}})("undefined"!==typeof exports?exports:this);
(function(h){var d=h.fabric||(h.fabric={}),g=d.util.object.extend,c=d.util.object.clone,a=d.util.toFixed,b=d.StaticCanvas.supports("setLineDash"),f=d.Object.NUM_FRACTION_DIGITS;d.Text?d.warn("fabric.Text is already defined"):(h=d.Object.prototype.stateProperties.concat(),h.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),d.Text=d.util.createClass(d.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,
fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:h,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},
_initDimensions:function(a){this.__skipDimension||(a||(a=d.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this._cacheLinesWidth="justify"!==this.textAlign,this.width=this._getTextWidth(a),this._cacheLinesWidth=!0,this.height=this._getTextHeight(a))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&d.util.clipContext(this,
a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextBackground(a);this._setStrokeStyles(a);this._setFillStyles(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&a.restore()},_renderText:function(a){this._translateForTextAlign(a);this._renderTextFill(a);this._renderTextStroke(a);this._translateForTextAlign(a,!0)},_translateForTextAlign:function(a,b){if("left"!==this.textAlign&&"justify"!==this.textAlign){var c=b?-1:1;a.translate("center"===this.textAlign?
c*this.width/2:c*this.width,0)}},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,d=this._textLines.length;c<d;c++){var f=this._getLineWidth(a,c);f>b&&(b=f)}return b},_renderChars:function(a,b,c,d,f){var g=a.slice(0,-4);if(this[g].toLive){var h=-this.width/2+this[g].offsetX||
0,C=-this.height/2+this[g].offsetY||0;b.save();b.translate(h,C);d-=h;f-=C}b[a](c,d,f);this[g].toLive&&b.restore()},_renderTextLine:function(a,b,c,d,f,g){f-=this.fontSize*this._fontSizeFraction;var h=this._getLineWidth(b,g);if("justify"!==this.textAlign||this.width<h)this._renderChars(a,b,c,d,f,g);else for(var h=c.split(/\s+/),C=this._getWidthOfWords(b,c,g),C=this.width-C,p=h.length-1,C=0<p?C/p:0,n=p=0,k,q=0,u=h.length;q<u;q++){for(;" "===c[n]&&n<c.length;)n++;k=h[q];this._renderChars(a,b,k,d+p,f,
g,n);p+=b.measureText(k).width+C;n+=k.length}},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck)for(var b=0,c=0,d=this._textLines.length;c<d;c++){var f=this._getHeightOfLine(a,c),g=f/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+g,c);b+=f}},
_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var c=0;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a);a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),b&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var d=0,f=this._textLines.length;d<f;d++){var g=this._getHeightOfLine(a,d),h=g/this.lineHeight;this._renderTextLine("strokeText",a,this._textLines[d],
this._getLeftOffset(),this._getTopOffset()+c+h,d);c+=g}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height))},_renderTextLinesBackground:function(a){if(this.textBackgroundColor){var b=
0,c=this._getHeightOfLine(),d,f;a.fillStyle=this.textBackgroundColor;for(var g=0,h=this._textLines.length;g<h;g++)""!==this._textLines[g]&&(d=this._getLineWidth(a,g),f=this._getLineLeftOffset(d),a.fillRect(this._getLeftOffset()+f,this._getTopOffset()+b,d,this.fontSize*this._fontSizeMult)),b+=c}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[]},_shouldClearCache:function(){var a=
!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return this.__lineWidths[b];var c,d=this._textLines[b];""===d?c=0:"justify"===this.textAlign&&this._cacheLinesWidth?(c=d.split(" "),c=1<c.length?this.width:a.measureText(d).width):c=a.measureText(d).width;this._cacheLinesWidth&&(this.__lineWidths[b]=c);return c},_renderTextDecoration:function(a){if(this.textDecoration){var b=
this.height/2,c=[];-1<this.textDecoration.indexOf("underline")&&c.push(.85);-1<this.textDecoration.indexOf("line-through")&&c.push(.43);-1<this.textDecoration.indexOf("overline")&&c.push(-.12);if(0<c.length){var d,f=0,g,h,C,p,n,k;d=0;for(g=this._textLines.length;d<g;d++){p=this._getLineWidth(a,d);n=this._getLineLeftOffset(p);k=this._getHeightOfLine(a,d);h=0;for(C=c.length;h<C;h++)a.fillRect(this._getLeftOffset()+n,f+(this._fontSizeMult-1+c[h])*this.fontSize-b,p,this.fontSize/15);f+=k}}}},_getFontDeclaration:function(){return[d.isLikelyNode?
this.fontWeight:this.fontStyle,d.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",d.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._render(a),a.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},
toObject:function(a){a=g(this.constructor.superclass.prototype.toObject.apply(this,[a]),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(this.ctx),c=this._getSVGTextAndBg(c.textTop,
c.textLeft);this._wrapSVGTextAndBg(b,c);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(a,b){a.push('\t<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,
"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',b.textSpans.join(""),"</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,b){var c=[],d=[],f=0;this._setSVGBg(d);for(var g=0,h=this._textLines.length;g<h;g++)this.textBackgroundColor&&this._setSVGTextLineBg(d,g,b,a,f),this._setSVGTextLineText(g,
c,f,b,a,d),f+=this._getHeightOfLine(this.ctx,g);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(b,c,g,h,y){g=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-y+g-this.height/2;c.push('<tspan x="',a(h+this._getLineLeftOffset(this._getLineWidth(this.ctx,b)),f),'" ','y="',a(g,f),'" ',this._getFillAttributes(this.fill),">",d.util.string.escapeXml(this._textLines[b]),"</tspan>")},_setSVGTextLineBg:function(b,c,d,g,h){b.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),
' x="',a(d+this._getLineLeftOffset(this._getLineWidth(this.ctx,c)),f),'" y="',a(h-this.height/2,f),'" width="',a(this._getLineWidth(this.ctx,c),f),'" height="',a(this._getHeightOfLine(this.ctx,c)/this.lineHeight,f),'"></rect>\n')},_setSVGBg:function(b){this.backgroundColor&&b.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,f),'" y="',a(-this.height/2,f),'" width="',a(this.width,f),'" height="',a(this.height,f),'"></rect>\n')},_getFillAttributes:function(a){var b=
a&&"string"===typeof a?new d.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.constructor.superclass.prototype._set.apply(this,[a,b]);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),d.Text.fromObject=function(a){return new d.Text(a.text,c(a))},d.util.createAccessors(d.Text))})("undefined"!==typeof exports?exports:this);
